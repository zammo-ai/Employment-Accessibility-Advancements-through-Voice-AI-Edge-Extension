/*! Zammo UI KIT JS
 * v0.6.12
 * Â© Zammo AI with <3
 * Build time: 01-04-2023 21:57:05
 */
[Element.prototype,CharacterData.prototype,DocumentType.prototype].forEach((function(t){t.hasOwnProperty("remove")||Object.defineProperty(t,"remove",{configurable:!0,enumerable:!0,writable:!0,value:function(){this.parentNode.removeChild(this)}})})),Array.from||(Array.from=function(){var t=Object.prototype.toString,e=function(e){return"function"==typeof e||"[object Function]"===t.call(e)},o=Math.pow(2,53)-1,n=function(t){var e=function(t){var e=Number(t);return isNaN(e)?0:0!==e&&isFinite(e)?(e>0?1:-1)*Math.floor(Math.abs(e)):e}(t);return Math.min(Math.max(e,0),o)};return function(t){var o=this,a=Object(t);if(null==t)throw new TypeError("Array.from requires an array-like object - not null or undefined");var i,s=arguments.length>1?arguments[1]:void 0;if(void 0!==s){if(!e(s))throw new TypeError("Array.from: when provided, the second argument must be a function");arguments.length>2&&(i=arguments[2])}for(var r,c=n(a.length),m=e(o)?Object(new o(c)):new Array(c),l=0;l<c;)r=a[l],m[l]=s?void 0===i?s(r,l):s.call(i,r,l):r,l+=1;return m.length=c,m}}());var ZammoBotUIKit={Extensions:[],constants:{MAX_POLLING_ATTEMPTS:5,POLLING_INTERVAL:5,ACTIVITIES_POLLING_INTERVAL:1,MAX_BUTTONS_PER_LINE:3,ZAMMO_BOT_UI_ID:"zammoBotUIComponent",customActivityType:{ZammoRequestLocation:"ZammoRequestLocation",ZammoSubmitLocation:"ZammoSubmitLocation"},SPEECH_TOKEN_EXPIRATION_TIME_IN_MS:6e5,REPLAY_MESSAGES_LOCAL_STORAGE_KEY:"zammo-bot-ui-kit-replay-messages",TRACKED_ACTIVITIES_LOCAL_STORAGE_KEY:"zammo-bot-ui-kit-tracked-activities",STAYOPEN_LOCALSTORAGE_KEY:"zammo-bot-ui-kit-stay-open"},ChatWidgetHooks:{START_OPENING_CHATBOT:"START_OPENING_CHATBOT",END_OPENING_CHATBOT:"END_OPENING_CHATBOT",START_CLOSING_CHATBOT:"START_CLOSING_CHATBOT",END_CLOSING_CHATBOT:"END_CLOSING_CHATBOT",START_PROCESSING_CHATBOT_ACTIVITY:"START_PROCESSING_CHATBOT_ACTIVITY",END_PROCESSING_CHATBOT_ACTIVITY:"END_PROCESSING_CHATBOT_ACTIVITY"},defaultAdapativeCardHostConfig:{containerStyles:{default:{foregroundColors:{default:{default:"#000000",subtle:"#767676"},accent:{default:"#0063B1",subtle:"#0078D4"},attention:{default:"#D13438",subtle:"#A4262C"},dark:{default:"#000000",subtle:"#646464"},good:{default:"#0B6A0B",subtle:"#028A02"},light:{default:"#FFFFFF",subtle:"#767676"},warning:{default:"#B75C00",subtle:"#986F0B"}}},emphasis:{backgroundColor:"#f57f17",foregroundColors:{default:{default:"#000000",subtle:"#484644"}}},accent:{backgroundColor:"#C7DEF9",foregroundColors:{default:{default:"#333333",subtle:"#484644"}}},good:{backgroundColor:"#CCFFCC",foregroundColors:{default:{default:"#333333",subtle:"#484644"}}},attention:{backgroundColor:"#FFC5B2",foregroundColors:{default:{default:"#333333",subtle:"#484644"}}},warning:{backgroundColor:"#FFE2B2",foregroundColors:{default:{default:"#333333",subtle:"#484644"}}}},supportsInteractivity:!0,fontFamily:"Montserrat",imageSizes:{small:40,medium:80,large:160},actions:{actionAlignment:"stretch",actionsOrientation:"vertical",buttonSpacing:8,maxActions:100,showCard:{actionMode:"inline",inlineTopMargin:8},spacing:"default"},adaptiveCard:{allowCustomStyle:!1},imageSet:{imageSize:"medium",maxImageHeight:100},factSet:{title:{color:"default",size:"default",isSubtle:!1,weight:"bolder",wrap:!0,maxWidth:150},value:{color:"default",size:"default",isSubtle:!1,weight:"default",wrap:!0},spacing:8}},
/*!
 * Sanitize and encode all HTML in a user-submitted string
 * (c) 2018 Chris Ferdinandi, MIT License, https://gomakethings.com
 * @param  {String} str  The user-submitted string
 * @return {String} str  The sanitized string
 */
sanitizeHTML:function(t){var e=document.createElement("div");return e.textContent=t,e.innerHTML},getFuzzyTime:function(t){var e=new Array(7);e[0]="Sunday",e[1]="Monday",e[2]="Tuesday",e[3]="Wednesday",e[4]="Thursday",e[5]="Friday",e[6]="Saturday";var o=new Array(13);o[0]="twelve",o[1]="one",o[2]="two",o[3]="three",o[4]="four",o[5]="five",o[6]="six",o[7]="seven",o[8]="eight",o[9]="nine",o[10]="ten",o[11]="eleven",o[12]="twelve";var n=new Array;n[5]="five",n[10]="ten",n[15]="quarter",n[20]="twenty",n[30]="half";var a=new Array;a.to="to",a.past="past";var i=new Array;i.sharp="o'clock";var s=t,r=s.getHours(),c=s.getMinutes(),m=s.minuteNames,l=r,d=c<10?"0"+c:c,u="AM",h="",p="",g="";return g=o[r%12],c<=33?h=a.past:(h=a.to,c=60-c,g=o[(r+1)%12]),l>12?(l-=12,u="PM"):12===l&&(u="PM"),0===l&&(l=12),c<4?(m="",p=i.sharp,h=""):m=c<8?n[5]:c<13?n[10]:c<18?n[15]:c<27?n[20]:n[30],{fuzzyTime:(m?m+" ":"")+(h?h+" ":"")+g+(p?" "+p:""),exactTime:l+":"+d+" "+u}},storage:function(){return{setStayOpen:function(t){window.localStorage&&window.localStorage.setItem(ZammoBotUIKit.constants.STAYOPEN_LOCALSTORAGE_KEY,t)},getStayOpen:function(){return!!window.localStorage&&"true"===window.localStorage.getItem(ZammoBotUIKit.constants.STAYOPEN_LOCALSTORAGE_KEY)},setConversationId:function(t){window.localStorage&&window.localStorage.setItem("zammo-bot-ui-kit-conversation-id",t)},getConversationId:function(){return window.localStorage?window.localStorage.getItem("zammo-bot-ui-kit-conversation-id"):null},setConversationToken:function(t){window.localStorage&&window.localStorage.setItem("zammo-bot-ui-kit-conversation-token",t)},getConversationToken:function(){return window.localStorage?window.localStorage.getItem("zammo-bot-ui-kit-conversation-token"):null},setHasStarted:function(t){window.localStorage&&window.localStorage.setItem("zammo-bot-ui-kit-has-started",t)},getHasStarted:function(){return!!window.localStorage&&"true"===window.localStorage.getItem("zammo-bot-ui-kit-has-started")},setUserId:function(t){window.localStorage&&window.localStorage.setItem("zammo-bot-ui-kit-user-id-dl",t)},getUserId:function(){return window.localStorage?window.localStorage.getItem("zammo-bot-ui-kit-user-id-dl"):null},setConversationTime:function(t){window.localStorage&&window.localStorage.setItem("zammo-bot-ui-kit-conversation-time",t)},getConversationTime:function(){return window.localStorage?window.localStorage.getItem("zammo-bot-ui-kit-conversation-time"):null},getCurrentTime:function(){return(new Date).getTime()},clearZammoItems:function(){window.localStorage.removeItem(STAYOPEN_LOCALSTORAGE_KEY),window.localStorage.removeItem("zammo-bot-ui-kit-conversation-id"),window.localStorage.removeItem("zammo-bot-ui-kit-conversation-token"),window.localStorage.removeItem("zammo-bot-ui-kit-has-started"),window.localStorage.removeItem("zammo-bot-ui-kit-user-id-dl"),window.localStorage.removeItem("zammo-bot-ui-kit-conversation-time")}}},getHTMLFromMarkdown:function(t){var e=ZammoBotUIKit.markdownit({html:!0,breaks:!0,linkify:!0}).render(t),o="";try{o=HtmlSanitizer.SanitizeHtml(e)}catch{return""}try{var n=document.createElement("div");return n.innerHTML=o,n.querySelectorAll("a").forEach(t=>{t.setAttribute("target","__blank"),t.setAttribute("rel","noopener noreferrer")}),n.innerHTML}catch{}return o},onDocumentReady:function(t){"loading"!==document.readyState?t():document.addEventListener?document.addEventListener("DOMContentLoaded",t):document.attachEvent("onreadystatechange",(function(){"loading"!==document.readyState&&t()}))},recreateNode:function(t,e){var o;if(e)o=t.cloneNode(!0),t.parentNode.replaceChild(o,t);else{for(o=t.cloneNode(!1);t.hasChildNodes();)o.appendChild(t.firstChild);t.parentNode.replaceChild(o,t)}return o}
/**
 * JavaScript HTML Sanitizer, (c) Alexander Yumashev, Jitbit Software.
 * @see https://github.com/jitbit/HtmlSanitizer
 * @license MIT https://github.com/jitbit/HtmlSanitizer/blob/master/LICENSE
 */},HtmlSanitizer=new function(){var t={A:!0,ABBR:!0,B:!0,BLOCKQUOTE:!0,BODY:!0,BR:!0,CENTER:!0,CODE:!0,DIV:!0,EM:!0,FONT:!0,H1:!0,H2:!0,H3:!0,H4:!0,H5:!0,H6:!0,HR:!0,I:!0,IMG:!0,LABEL:!0,LI:!0,OL:!0,P:!0,PRE:!0,SMALL:!0,SOURCE:!0,SPAN:!0,STRONG:!0,TABLE:!0,TBODY:!0,TR:!0,TD:!0,TH:!0,THEAD:!0,UL:!0,U:!0,VIDEO:!0},e={FORM:!0},o={align:!0,color:!0,controls:!0,height:!0,href:!0,src:!0,style:!0,target:!0,title:!0,type:!0,width:!0},n={color:!0,"background-color":!0,"font-size":!0,"text-align":!0,"text-decoration":!0,"font-weight":!0},a=["http:","https:","data:","m-files:","file:","ftp:","ftps:","mailto:"],i={href:!0,action:!0};this.startsWithAny=function(t,e){for(var o=0;o<e.length;o++)if(0==t.indexOf(e[o]))return!0;return!1},this.makeSanitizedCopy=function(r,c){if(r.nodeType==Node.TEXT_NODE)var m=r.cloneNode(!0);else if(r.nodeType==Node.ELEMENT_NODE&&(t[r.tagName]||e[r.tagName])){if(("SPAN"==r.tagName||"B"==r.tagName||"I"==r.tagName||"U"==r.tagName)&&""==r.innerHTML.trim())return document.createDocumentFragment();m=e[r.tagName]?c.createElement("DIV"):c.createElement(r.tagName);for(var l=0;l<r.attributes.length;l++){var d=r.attributes[l];if(o[d.name])if("style"==d.name)for(s=0;s<r.style.length;s++){var u=r.style[s];n[u]&&m.style.setProperty(u,r.style.getPropertyValue(u))}else{if(i[d.name]&&d.value.indexOf(":")>-1&&!this.startsWithAny(d.value,a))continue;m.setAttribute(d.name,d.value)}}for(l=0;l<r.childNodes.length;l++){var h=this.makeSanitizedCopy(r.childNodes[l],c);m.appendChild(h,!1)}}else m=document.createDocumentFragment();return m},this.getIframedoc=function(t){return t.contentDocument||t.contentWindow.document},this.initializeIframe=function(t,e){document.body.appendChild(e);var o=this.getIframedoc(e);return null==o.body&&o.write("<body></body>"),o.body.innerHTML=t,e},this.processIframe=function(t){var e=this.getIframedoc(t),o=this.makeSanitizedCopy(e.body,e);return document.body.removeChild(t),o.innerHTML.replace(/<br[^>]*>(\S)/g,"<br>\n$1").replace(/div><div/g,"div>\n<div")},this.SanitizeHtml=function(t){if(""===(t=t.trim()))return"";if("<br>"===t)return"";var e=document.createElement("iframe");return void 0===e.sandbox?(alert("Your browser does not support sandboxed iframes. Please upgrade to a modern browser."),""):(e.sandbox="allow-same-origin",e.style.display="none",e=this.initializeIframe(t,e),this.processIframe(e))},this.AllowedTags=t,this.AllowedAttributes=o,this.AllowedCssStyles=n,this.AllowedSchemas=a};ZammoBotUIKit.addViewportIfNotAvailable=function(){var t=document.querySelector('meta[name="viewport"]');if(!(t&&t.hasAttribute("content"))){var e=document.createElement("meta");e.id="zammo-ui-kit-viewport",e.name="viewport",e.content="width=device-width, initial-scale=1",document.getElementsByTagName("head")[0].appendChild(e)}},ZammoBotUIKit.Logger=function(t){this.environment=t,this.log=function(){"development"===this.environment&&console.log.apply(console,arguments)},this.error=function(){"development"===this.environment&&console.error.apply(console,arguments)}},ZammoBotUIKit.isNullOrEmpty=function(t){return null===t||""===t},ZammoBotUIKit.getAttributeOrDefault=function(t,e,o){var n=t.getAttribute(e);return ZammoBotUIKit.isNullOrEmpty(n)?o:n},ZammoBotUIKit.getCacheProtectedUrl=function(t){return t+(/\?/.test(t)?"&":"?")+(new Date).getTime()},ZammoBotUIKit.removeClass=function(t,e){for(var o=t.split(" "),n=[],a=0;a<o.length;a++)o[a]!==e&&n.push(o[a]);return n.join(" ")},ZammoBotUIKit.addClass=function(t,e){var o=t.split(" ");return o.push(e),o.join(" ")},ZammoBotUIKit.makeHTTPCall=function(t,e,o,n,a,i){o=void 0!==o?o:"GET",n=void 0!==n?n:null,a=void 0!==a?a:null;var s=new XMLHttpRequest;if(s.onload=function(t){var o=t.target;if(o.status>=400){var n="json"===o.responseType?o.response:JSON.parse(o.responseText);i?i(n):console.error("A fatal error occurred while making a network call. We show you the error to attempt to debug. Please contact your Zammo account manager.",n)}else"json"===o.responseType?e(o.response):e(JSON.parse(o.responseText))},s.onerror=function(t){var e=t.target;i&&i(t,e.status,e.statusText)},s.open(o,ZammoBotUIKit.getCacheProtectedUrl(t)),a)for(var r=Object.keys(a),c=0;c<r.length;c++){var m=r[c],l=a[m];s.setRequestHeader(m,l)}s.responseType="json",s.send(n)},ZammoBotUIKit.postForm=function(t,e,o,n,a){n=void 0!==n?n:null;var i=new XMLHttpRequest,s=new FormData;if(i.onload=function(){e&&e(i.response,i.status)},i.open("post",t),n)for(var r=Object.keys(n),c=0;c<r.length;c++){var m=r[c],l=n[m];i.setRequestHeader(m,l)}var d=(new Date).toISOString(),u=Array.from(o.files),h={type:"message",channelData:{attachmentSizes:u.map((function(t){return t.size})),pageUrl:window.location.href,clientTimestamp:d},from:a},p=new Blob([JSON.stringify(h)],{type:"application/vnd.microsoft.activity"});s.append("activity",p),u.forEach((function(t){s.append("files",t)})),i.send(s)},ZammoBotUIKit.uuidv4=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)}))},ZammoBotUIKit.checkExpiry=function(t){try{var e=ZammoBotUIKit.storage();if(parseInt(t)>0){var o=e.getCurrentTime(),n=e.getConversationTime(),a=!0===(n&&parseInt(n)+parseInt(t)<o);if(!n||a)return e.clearZammoItems(),e.setConversationTime(o),!0}return!1}catch(t){return!1}},ZammoBotUIKit.getUserId=function(t){try{var e=ZammoBotUIKit.storage();if(ZammoBotUIKit.checkExpiry(t),e.getUserId())return e.getUserId();var o="dl_"+ZammoBotUIKit.uuidv4();return e.setUserId(o),o}catch(t){return"dl_"+ZammoBotUIKit.uuidv4()}},ZammoBotUIKit.simpleUpdateIn=function(t,e,o){if(!e||0===e.length||!t||"object"!=typeof t)return t;var n=e[0];return t[n]||(t[n]={}),1==e.length?t[n]=o:t[n]=ZammoBotUIKit.simpleUpdateIn(t[n],e.slice(1),o),t},ZammoBotUIKit.formatDate=function(t){var e="0"+t.getHours(),o="0"+t.getMinutes();return e.slice(-2)+":"+o.slice(-2)},ZammoBotUIKit.isElementInViewport=function(t){"function"==typeof jQuery&&t instanceof jQuery&&(t=t[0]);var e=t.getBoundingClientRect();return e.top>=0&&e.left>=0&&e.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&e.right<=(window.innerWidth||document.documentElement.clientWidth)},ZammoBotUIKit.isset=function(t){return t&&void 0!==t},ZammoBotUIKit.openInNewTab=function(t){Object.assign(document.createElement("a"),{target:"_blank",href:t}).click()},ZammoBotUIKit.get=function(t,e,o){o=void 0!==o?o:void 0;var n=function(o){return String.prototype.split.call(e,o).filter(Boolean).reduce((function(t,e){return null!=t?t[e]:t}),t)},a=n(/[,[\]]+?/)||n(/[,[\].]+?/);return null==a||a===t?o:a},ZammoBotUIKit.AttachmentTypes={OAUTH:"application/vnd.microsoft.card.oauth",HERO:"application/vnd.microsoft.card.hero",THUMBNAIL:"application/vnd.microsoft.card.thumbnail",VIDEO:"application/vnd.microsoft.card.video",AUDIO:"application/vnd.microsoft.card.audio",PLAIN_VIDEO:"video/mp4",PLAIN_TEXT:"text/plain",PLAIN_AUDIO:"audio/mpeg",MARKDOWN_TEXT:"text/markdown",SIGN_IN:"application/vnd.microsoft.card.signin",ADAPTIVE_CARD:"application/vnd.microsoft.card.adaptive"},ZammoBotUIKit.ActionTypes={OPEN_URL:"Action.OpenUrl",SHOW_CARD:"Action.ShowCard",SUBMIT:"Action.Submit"},ZammoBotUIKit.isObject=function(t){var e=typeof t;return"function"===e||"object"===e&&!!t},ZammoBotUIKit.isNullOrUndefined=function(t){return null==t},ZammoBotUIKit.mergeJSON=function(t,e){function o(t){if("object"==typeof t)for(var e in t)if(t.hasOwnProperty(e))return!0;return!1}for(var n in e)e.hasOwnProperty(n)&&(t[n]&&o(t[n])&&o(e[n])?this.mergeJSON(t[n],e[n]):t[n]=e[n]);return t},ZammoBotUIKit.isWebSocketWorking=function(t,e){try{return new WebSocket(t),!0}catch(t){e&&e.error("ZammoBotUIKit.isWebSocketWorking","websocket error",t)}return!1},ZammoBotUIKit.isWebSocketSupported=function(t,e){return t=ZammoBotUIKit.isNullOrUndefined(t)?"wss://echo.websocket.org":t,!(!(WebSocket in window)&&ZammoBotUIKit.isNullOrUndefined(window.WebSocket)&&!ZammoBotUIKit.isWebSocketWorking(t,e))},ZammoBotUIKit.IsStrAValidJson=function(t){try{JSON.parse(t)}catch(t){return!1}return!0},ZammoBotUIKit.AttachmentService={chunkArrToMultiDimArr:function(t,e){for(var o=[];t.length>0;)o.push(t.slice(0,e)),t=t.slice(e);return o},getCardButtonsHTML:function(t){if(!t||0===t.length)return"";for(var e=[],o=t.length,n=ZammoBotUIKit.AttachmentService.chunkArrToMultiDimArr(t,1===o?1:o%2==0?2:3),a=0;a<n.length;a++)for(var i=0;i<n[a].length;i++){var s=n[a][i],r=ZammoBotUIKit.get(s,"value",""),c=ZammoBotUIKit.get(s,"text",""),m=ZammoBotUIKit.get(s,"title",""),l=m||s.text,d=ZammoBotUIKit.isObject(r)?'card-action-value="'+JSON.stringify(s.value).replace(/[\""]/g,"'")+'"':'card-action-value="'+s.value+'"',u='<button class="mdc-button mdc-card__action mdc-card__action--button '+(n[a].length,'zammo-button-single-per-row"card-action-type="')+s.type+'"'+d+'card-action-text="'+c.replace(/[\""]/g,"'")+'"card-action-display-text="'+s.displayText+'"><div class="mdc-button__ripple"></div><span class="mdc-button__label">'+l.replace(/[\""]/g,"'")+"</span></button>";e.push(u)}return heroCardButtonsHTML='<div class="mdc-card__actions"><div class="mdc-card__action-buttons">'+e.join("\n")+"</div></div>",heroCardButtonsHTML},getCardTextContentHTML:function(t,e,o){return(t?'<h2 class="zammo-card__title mdc-typography mdc-typography--headline6">'+t+"</h2>":"")+(e?'<h3 class="zammo-card__subhead mdc-typography mdc-typography--subtitle2">'+e+"</h3>":"")+(o?'<p class="zammo-card__supporting-text">'+o+"</p>":"")},getRichMediaCardAttachmentHTML:function(t){var e=ZammoBotUIKit.get(t,"content.image.url",""),o=e?'<div class="mdc-card__media mdc-card__media--square zammo-card__media-thumbnail" style="background-image: url(&quot;'+e+'&quot;);"><div class="mdc-card__media-content"></div></div>':"",n=ZammoBotUIKit.get(t,"contentType")===ZammoBotUIKit.AttachmentTypes.VIDEO?"video":"audio",a=ZammoBotUIKit.get(t,"content.title"),i=ZammoBotUIKit.get(t,"content.subtitle"),s=ZammoBotUIKit.get(t,"content.text");return'<div class="mdc-card" style="width:fit-content;"><div class="mdc-card__primary-action zammo-card__primary-action'+(a||i||s||e?"":"zammo-no-header")+'" tabindex="0">'+o+'<div class="zammo-card__primary '+(a||i||s?"":"zammo-no-title")+'">'+ZammoBotUIKit.AttachmentService.getCardTextContentHTML(a,i,s)+'</div></div><div class="mdc-card__primary-action mdc-ripple-upgraded"><'+n+' class="zammo-card__media-rich" controls poster="'+e+'"><source src="'+ZammoBotUIKit.get(t,"content.media.0.url")+"\">Sorry, your browser doesn't support embedded videos.</"+n+"></div>"+ZammoBotUIKit.AttachmentService.getCardButtonsHTML(ZammoBotUIKit.get(t,"content.buttons"))+"</div>"},getVideoAttachment:function(t){var e,o,n,a=ZammoBotUIKit.get(t,"name"),i=a?'<h2 class="zammo-card__title mdc-typography mdc-typography--headline6">'+a+"</h2>":"";return'<div class="mdc-card" style="width:fit-content;"><div class="mdc-card__primary-action mdc-ripple-upgraded"><iframe src="'+(e=ZammoBotUIKit.get(t,"contentUrl"),n=e,(o=e.match(/^.*(vimeo\.com\/)((channels\/[A-z]+\/)|(groups\/[A-z]+\/videos\/))?([0-9]+)/))?n="https://player.vimeo.com/video/"+o[5]+"?autoplay=0&badge=0&byline=0&loop=0&portrait=0&title=0":(o=e.match(/^.*(youtu\.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/))&&11===o[2].length&&(n="https://www.youtube.com/embed/"+o[2]+"?autoplay=0&loop=0&modestbranding=1"),n+'" style="width:100%" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe></div><div class="zammo-card__primary">')+i+"</div></div>"},getAudioAttachment:function(t){var e=ZammoBotUIKit.get(t,"name"),o=e?'<h2 class="zammo-card__title mdc-typography mdc-typography--headline6">'+e+"</h2>":"";return'<div class="mdc-card" style="width:fit-content;"><div class="mdc-card__primary-action mdc-ripple-upgraded"><audio class="zammo-card__media-rich" controls><source src="'+ZammoBotUIKit.get(t,"contentUrl")+'">Sorry, your browser doesn\'t support embedded videos.</audio></div><div class="zammo-card__primary">'+o+"</div></div>"},getHeroCardAttachmentHTML:function(t){var e=ZammoBotUIKit.get(t,"content.images.0.url");return'<div class="mdc-card" style="width:fit-content;">'+(e?'<div class="mdc-card__media mdc-card__media--square" style="background-size: contain;background-image: url(&quot;'+e+'&quot;);"><div class="mdc-card__media-content"></div></div>':"")+'<div class="mdc-card-wrapper__text-section">'+ZammoBotUIKit.AttachmentService.getCardTextContentHTML(ZammoBotUIKit.get(t,"content.title"),ZammoBotUIKit.get(t,"content.subtitle"),ZammoBotUIKit.get(t,"content.text"))+"</div>"+ZammoBotUIKit.AttachmentService.getCardButtonsHTML(ZammoBotUIKit.get(t,"content.buttons"))+"</div>"},getThumbnailCardAttachmentHTML:function(t){var e=ZammoBotUIKit.get(t,"content.images.0.url");return'<div class="mdc-card" style="width:fit-content;"><div class="mdc-card__primary-action zammo-card__primary-action" tabindex="0">'+(e?'<div class="mdc-card__media mdc-card__media--square zammo-card__media" style="background-image: url(&quot;'+e+'&quot;);"></div>':"")+'<div class="zammo-card__primary">'+ZammoBotUIKit.AttachmentService.getCardTextContentHTML(ZammoBotUIKit.get(t,"content.title"),ZammoBotUIKit.get(t,"content.subtitle"),ZammoBotUIKit.get(t,"content.text"))+"</div></div>"+ZammoBotUIKit.AttachmentService.getCardButtonsHTML(ZammoBotUIKit.get(t,"content.buttons"))+"</div>"},getAdaptiveCardAttachment:function(t,e){var o=ZammoBotUIKit.get(t,"content"),n=new AdaptiveCards.AdaptiveCard,a=e&&e.customAdapativeCardHostConfig?ZammoBotUIKit.mergeJSON(ZammoBotUIKit.defaultAdapativeCardHostConfig,e.customAdapativeCardHostConfig):ZammoBotUIKit.defaultAdapativeCardHostConfig;n.hostConfig=new AdaptiveCards.HostConfig(a),n.onExecuteAction=function(t){var o=ZammoBotUIKit.get(t,"_propertyBag.type"),n=ZammoBotUIKit.get(t,"_processedData");switch(o){case ZammoBotUIKit.ActionTypes.OPEN_URL:return void ZammoBotUIKit.openInNewTab(ZammoBotUIKit.get(t,"url"));case ZammoBotUIKit.ActionTypes.SUBMIT:var a=(new Date).toISOString(),i={channelData:{pageUrl:window.location.href,clientTimestamp:a,postBack:!0},text:"string"==typeof n?n:void 0,value:"string"!=typeof n?n:void 0,type:"message",channelId:"webchat",from:e.user,timestamp:a,entities:[{requiresBotState:!0,supportsListening:!0,supportsTts:!0,type:"ClientCapabilities"}]};return void e.sendActivity(i);default:return}},n.parse(o);var i=n.render();if(i&&e&&e.chatArea){i.className=ZammoBotUIKit.addClass(i.className,"mdc-card");var s="adaptive-card-"+ZammoBotUIKit.uuidv4();return e.adaptiveCardsToBind||(e.adaptiveCardsToBind=[]),e.adaptiveCardsToBind.push({id:s,data:i}),'<div id="'+s+'"></div>'}return""},getAttachmentHTML:function(t,e){if(!t)return"";switch(t.contentType){case ZammoBotUIKit.AttachmentTypes.HERO:return ZammoBotUIKit.AttachmentService.getHeroCardAttachmentHTML(t);case ZammoBotUIKit.AttachmentTypes.THUMBNAIL:return ZammoBotUIKit.AttachmentService.getThumbnailCardAttachmentHTML(t);case ZammoBotUIKit.AttachmentTypes.PLAIN_TEXT:return ZammoBotUIKit.get(t,"content","");case ZammoBotUIKit.AttachmentTypes.MARKDOWN_TEXT:return ZammoBotUIKit.getHTMLFromMarkdown(ZammoBotUIKit.get(t,"content",""));case ZammoBotUIKit.AttachmentTypes.AUDIO:case ZammoBotUIKit.AttachmentTypes.VIDEO:return ZammoBotUIKit.AttachmentService.getRichMediaCardAttachmentHTML(t);case ZammoBotUIKit.AttachmentTypes.PLAIN_AUDIO:return ZammoBotUIKit.AttachmentService.getAudioAttachment(t);case ZammoBotUIKit.AttachmentTypes.PLAIN_VIDEO:return ZammoBotUIKit.AttachmentService.getVideoAttachment(t);case ZammoBotUIKit.AttachmentTypes.SIGN_IN:case ZammoBotUIKit.AttachmentTypes.OAUTH:return ZammoBotUIKit.AttachmentService.getHeroCardAttachmentHTML(t);case ZammoBotUIKit.AttachmentTypes.ADAPTIVE_CARD:return ZammoBotUIKit.AttachmentService.getAdaptiveCardAttachment(t,e);default:return""}},getAttachmentsHTML:function(t,e){if(!t)return"";for(var o=[],n=0;n<t.length;n++){var a=ZammoBotUIKit.AttachmentService.getAttachmentHTML(t[n],e);o.push(a)}return'<div class="zammo-message-attachments">'+o.join('\n<div class="zammo-message-attachments-sep"></div>\n')+"</div>"}},ZammoBotUIKit.CardActionTypes={OPEN_URL:"openUrl",IM_BACK:"imBack",MESSAGE_BACK:"messageBack",SIGN_IN:"signin"},ZammoBotUIKit.loadScriptWithoutRequire=function(t,e){var o=document.getElementsByTagName("head")[0],n=document.createElement("script");n.src=t;var a=!1;n.onload=n.onreadystatechange=function(){a||this.readyState&&"loaded"!=this.readyState&&"complete"!=this.readyState||(a=!0,"function"==typeof e&&e(),n.onload=n.onreadystatechange=null,o.removeChild(n))},o.appendChild(n)},ZammoBotUIKit.loadScript=function(t,e){var o=!1;if("undefined"==typeof require||"function"!=typeof require)ZammoBotUIKit.loadScriptWithoutRequire(t,e);else{const n=setTimeout((function(){o=!0,ZammoBotUIKit.loadScriptWithoutRequire(t,e)}),1500);require([t],(function(t){o||(clearTimeout(n),e(t))}))}},ZammoBotUIKit.loadStyle=function(t,e,o,n){if(n=void 0!==n&&n,!document.getElementById(e)){var a=document.getElementsByTagName("head")[0],i=document.createElement("link");i.id=e,i.rel="stylesheet",i.type="text/css",i.href=t,i.media="all";var s=!1;n&&(i.rel="stylesheet preload",i.as="style"),i.onload=i.onreadystatechange=function(){s||this.readyState&&"loaded"!=this.readyState&&"complete"!=this.readyState||(s=!0,i.rel="stylesheet","function"==typeof o&&o(),i.onload=i.onreadystatechange=null)},a.appendChild(i)}},ZammoBotUIKit.cyrb53=function(t,e=0){for(var o,n=3735928559^e,a=1103547991^e,i=0;i<t.length;i++)o=t.charCodeAt(i),n=Math.imul(n^o,2654435761),a=Math.imul(a^o,1597334677);return n=Math.imul(n^n>>>16,2246822507)^Math.imul(a^a>>>13,3266489909),4294967296*(2097151&(a=Math.imul(a^a>>>16,2246822507)^Math.imul(n^n>>>13,3266489909)))+(n>>>0)},ZammoBotUIKit.ZammoBotUIModal=function(t){this.title=t.title,this.body=t.body,this.confirmButtonLabel=t.confirmButtonLabel?t.confirmButtonLabel:"OK",this.showConfirmButton=!t.showConfirmButton||t.showConfirmButton,this.onConfirmButtonClick=t.onConfirmButtonClick,this.cancelButtonLabel=t.cancelButtonLabel?t.cancelButtonLabel:"Cancel",this.showCancelButton=!t.showCancelButton||t.showCancelButton,this.onCancelButtonClick=t.onCancelButtonClick,this.styles=t.styles?t.styles:[],this.id="zammoBotUIComponent--chatFrame--modal",this.close=function(){if(this.currentElementInWhichTheChatbotModalIsDisplayed){var t=this.currentElementInWhichTheChatbotModalIsDisplayed.querySelector("#"+this.id);t&&this.currentElementInWhichTheChatbotModalIsDisplayed.removeChild(t)}this.currentElementInWhichTheChatbotModalIsDisplayedStyle&&this.currentElementInWhichTheChatbotModalIsDisplayedStyle.parentNode.removeChild(this.currentElementInWhichTheChatbotModalIsDisplayedStyle)},this.displayModal=function(t){for(var e,o=this,n="",a=0;a<o.styles.length;a++){var i=o.styles[a];i.selector&&i.content&&(n=n+"\n#"+o.id+" "+i.selector+" {\n"+i.content+"\n}")}if(!ZammoBotUIKit.isNullOrEmpty(n)){var s=document.createElement("style");s.innerHTML=n,(document.head||document.getElementsByTagName("head")[0]).appendChild(s),o.currentElementInWhichTheChatbotModalIsDisplayedStyle=i}try{e=document.querySelector(t)}catch(t){console.warn("zammo-bot-ui-kit::","attempting to display the bot in a div that does not exist. Zammo will use body instead")}e||(e=document.querySelector("body")),o.currentElementInWhichTheChatbotModalIsDisplayed=e;var r=e.querySelector(o.id),c=o.showConfirmButton?'<button id="zammoBotUIComponent--chatFrame--modal--content--footer--confirm-button" class="zammoBotUIComponent--chatFrame--modal--content--footer--button"></button>':"",m=o.showConfirmButton?'<button id="zammoBotUIComponent--chatFrame--modal--content--footer--cancel-button" class="zammoBotUIComponent--chatFrame--modal--content--footer--button"></button>':"";if(!r){var l=document.createElement("div");l.id=o.id;var d='<div id="zammoBotUIComponent--chatFrame--modal--content"><button id="zammoBotUIComponent--chatFrame--modal--content--header--close-button" aria-label="close modal in the chat"><i class="material-icons" id="zammoBotUIComponent--chatIcon--icon">close</i></button><div id="zammoBotUIComponent--chatFrame--modal--content--header"><div id="zammoBotUIComponent--chatFrame--modal--content--header--title"></div></div><div id="zammoBotUIComponent--chatFrame--modal--content--body"></div><div id="zammoBotUIComponent--chatFrame--modal--content--footer">'+c+m+"</div></div>";l.insertAdjacentHTML("beforeend",d),e.appendChild(l);var u=function(t){return t&&"[object Function]"==={}.toString.call(t)},h=function(t,e,n){var a=o.currentElementInWhichTheChatbotModalIsDisplayed.querySelector(t);a?a.addEventListener("click",(function(){u(e)?e():u(n)?n():o.close()})):console.warn("zammo-bot-ui-kit::","attempting to add a click event listener to a div that doesn't exist")};h("#zammoBotUIComponent--chatFrame--modal--content--header--close-button",o.onClosingIconClick),h("#zammoBotUIComponent--chatFrame--modal--content--footer--confirm-button",o.onConfirmButtonClick),h("#zammoBotUIComponent--chatFrame--modal--content--footer--cancel-button",o.onCancelButtonClick);var p=function(t,e){var n,a=o.currentElementInWhichTheChatbotModalIsDisplayed.querySelector(t);a?(n=e)instanceof Element||n instanceof HTMLDocument?a.appendChild(e):a.insertAdjacentHTML("beforeend",e):console.warn("zammo-bot-ui-kit::","error while attempting to add the div to",t)};o.body&&p("#zammoBotUIComponent--chatFrame--modal--content--body",o.body),o.title&&p("#zammoBotUIComponent--chatFrame--modal--content--header--title",o.title),o.confirmButtonLabel&&p("#zammoBotUIComponent--chatFrame--modal--content--footer--confirm-button",o.confirmButtonLabel),o.cancelButtonLabel&&p("#zammoBotUIComponent--chatFrame--modal--content--footer--cancel-button",o.cancelButtonLabel)}}},ZammoBotUIKit.ZammoBotUI=function(t){this.environment=t.environment,this.cssUrl=t.cssUrl,this.logger=new ZammoBotUIKit.Logger(t.environment),this.webChatId=t.webChatId,this.zammoApiBaseUrl=t.zammoApiBaseUrl,this.stickyChat="true"===t.stickyChat,this.shouldHideBranding=t.shouldHideBranding,this.ttlInMilliseconds=t.ttlInMilliseconds,this.directLineUrl=t.directLineUrl,this.shouldLoadDependencies=t.shouldLoadDependencies,this.shouldShowMicrophone=t.shouldShowMicrophone,this.shouldShowExtensionMenu=t.shouldShowExtensionMenu,this.simulatorToken=t.simulatorToken,this.loadingDivId=t.loadingDivId,this.shouldIgnoreUiBuilderIgnore=t.shouldIgnoreUiBuilderIgnore,this.shouldDisableBargeIn=t.shouldDisableBargeIn,this.shouldAllowUserToDownloadTranscript=t.shouldAllowUserToDownloadTranscript,this.lastMessageLocale="en-US",this.messages={},this.user={id:ZammoBotUIKit.getUserId(t.ttlInMilliseconds),role:"user"},this.hasReceivedAMessage=!1,this.pollingAttemptsCount=0,this.addExtension=function(t){t&&ZammoBotUIKit&&ZammoBotUIKit.Extensions&&!ZammoBotUIKit.Extensions.find(e=>e.id===t.id)&&ZammoBotUIKit.Extensions.push(t)},this.announceHook=function(t,e){try{for(var o of ZammoBotUIKit.Extensions)if(o&&o.canHandleHook&&o.canHandleHook(t)&&o.handleHook&&(o.handleHook(t,this,e),!o.shouldContinueAfterHandlingHook||!o.shouldContinueAfterHandlingHook(t)))return!1}catch(t){console.error("An error occurred while attempting to use a Zammo extension. Please verify your extension code or contact your vendor for assistance."),console.error("The error was",t)}return!0},this.loadRequiredStylesAndScripts=function(t){var e=this;"false"!==this.shouldLoadDependencies?(ZammoBotUIKit.loadScript("https://cdnjs.cloudflare.com/ajax/libs/markdown-it/12.2.0/markdown-it.min.js",(function(o){ZammoBotUIKit.isset(o)?(e.logger.log("ZammoBotUIKit.ZammoBotUI.run::","Markdown-it was loaded with RequireJS"),ZammoBotUIKit.markdownit=o):(e.logger.log("ZammoBotUIKit.ZammoBotUI.run::","Markdown-it was loaded without RequireJS",window.markdownit),ZammoBotUIKit.markdownit=window.markdownit),e.logger.log("ZammoBotUIKit.ZammoBotUI.run::","finished loading Markdown-it library"),ZammoBotUIKit.loadScript("https://unpkg.com/adaptivecards@2.10.0/dist/adaptivecards.min.js",(function(o){o&&(e.logger.log("ZammoBotUIKit.ZammoBotUI.run::","Adaptive card was loaded with RequireJS","loadedAdaptiveCard",o),window.AdaptiveCards=o),e.logger.log("ZammoBotUIKit.ZammoBotUI.run::","finished loading the adaptive dialog library"),ZammoBotUIKit.loadScript("https://cdn.jsdelivr.net/npm/microsoft-cognitiveservices-speech-sdk@latest/distrib/browser/microsoft.cognitiveservices.speech.sdk.bundle-min.js",(function(o){o&&(e.logger.log("ZammoBotUIKit.ZammoBotUI.run::","Speech SDK was loaded with RequireJS","loadedSpeechSDK",o),window.SpeechSDK=o),e.logger.log("ZammoBotUIKit.ZammoBotUI.run::","finished loading the speech SDK library"),t()}))}))})),ZammoBotUIKit.loadStyle(ZammoBotUIKit.getCacheProtectedUrl(e.cssUrl),"zammoBotUIKitStyle",(function(){e.logger.log("ZammoBotUIKit.ZammoBotUI.run::","finished loading zammo bot ui kit style")}),!0),ZammoBotUIKit.loadStyle("https://unpkg.com/material-components-web@7.0.0/dist/material-components-web.min.css","zammoBotUIMaterialIO",(function(){e.logger.log("ZammoBotUIKit.ZammoBotUI.run::","finished loading material.io styles.")})),ZammoBotUIKit.loadStyle("https://fonts.googleapis.com/css?family=Montserrat","zammoBotUIStyleFont",(function(){e.logger.log("ZammoBotUIKit.ZammoBotUI.run::","finished loading Montserrat font.")})),ZammoBotUIKit.loadStyle("https://fonts.googleapis.com/icon?family=Material+Icons","zammoBotUIKitStyleFontEmoji",(function(){e.logger.log("ZammoBotUIKit.ZammoBotUI.run::","finished loading Material Icon")}))):t()},this.getBotUIComponent=function(t){var e=document.createElement("div");e.id=ZammoBotUIKit.constants.ZAMMO_BOT_UI_ID;var o=this.shouldHideBranding?"":'<div id="zammoBotUIComponent--chatFrame--footer">powered with <i class="material-icons">favorite</i> by <a href="https://zammo.ai" id="zammo-url">zammo.ai</a></div>',n=window.SpeechSDK&&this.shouldShowMicrophone?'<button id="zammoBotUIComponent--chatFrame--microphone"><i class="material-icons">mic</i></button>':"",a=this.shouldShowExtensionMenu?'<div id="zammoBotUIComponent--chatFrame--header--extension-menu" class="zammoBotUIComponent--chatFrame--header--extension-menu--hidden">\x3c!-- three dots --\x3e<ul id="zammoBotUIComponent--chatFrame--header--extension-menu--icons" tabindex="0" aria-label="additional options for the chabot button"><li></li><li></li><li></li></ul>\x3c!-- menu --\x3e<div id="zammoBotUIComponent--chatFrame--header--extension-menu--options"></div></div><button id="zammoBotUIComponent--chatFrame--header--extension-menu--options--refresh-session-button" class="zammoBotUIComponent--chatFrame--header--extension-menu--hidden" title="restart the session with the chatbot"  aria-label="refresh the chatbot session"><i class="material-icons" id="zammoBotUIComponent--chatIcon--icon">refresh</i></button>':"";return e.innerHTML='<button id="zammoBotUIComponent--chatIcon" aria-label="open chat bot"><i class="material-icons" id="zammoBotUIComponent--chatIcon--icon">question_answer</i></button><div id="zammoBotUIComponent--chatFrame"><div id="zammoBotUIComponent--chatFrame--draggable-section" class="zammoBotUIComponent--chatFrame--draggable-section"></div><div id="zammoBotUIComponent--chatFrame--header">'+a+(t?"":'<button id="zammoBotUIComponent--chatFrame--header--closeIcon"><i class="material-icons mode-close">close</i></button>')+'</div><div id="zammoBotUIComponent--chatFrame--chat"><section class="msger"><main class="msger-chat" tabindex="0" aria-live="polite" aria-label="Chatbot conversation"></main>'+(t?"":'<form class="msger-inputarea">'+n+'<input aria-label="Message to ask the bot input box" type="text" class="msger-input" placeholder="Enter your message..."><button type="submit" class="msger-send-btn"><i class="material-icons">send</i></button></form>')+'</section></div><div id="zammoBotUIComponent--chatEventBar"><span></span></div>'+o+"</div>",e},this.showDraggableSection=function(){var t=document.querySelector("#zammoBotUIComponent--chatFrame--draggable-section");t&&(t.style.display="block")},this.hideDraggableSection=function(){var t=document.querySelector("#zammoBotUIComponent--chatFrame--draggable-section");t&&(t.style.display="none")},this.disableUserInput=function(){this.chatInputForm&&(this.chatInputForm.className=ZammoBotUIKit.addClass(this.chatInputForm.className,"user-input-disabled")),this.chatInput&&(this.chatInput.disabled=!0),this.chatInputMicrophoneButton&&(this.chatInputMicrophoneButton.disabled=!0),this.chatInputSendButton&&(this.chatInputSendButton.disabled=!0)},this.enableUserInput=function(){this.chatInputForm&&(this.chatInputForm.className=ZammoBotUIKit.removeClass(this.chatInputForm.className,"user-input-disabled")),this.chatInput&&(this.chatInput.disabled=!1),this.chatInputMicrophoneButton&&(this.chatInputMicrophoneButton.disabled=!1),this.chatInputSendButton&&(this.chatInputSendButton.disabled=!1),this.setFocusOnChatInput()},this.processUserInput=function(t,e,o){if(t){t=ZammoBotUIKit.sanitizeHTML(t),e=void 0!==e?e:null,o=void 0!==o?o:null;var n=(new Date).toISOString();this.removeSuggestedActions(),this.chatInput.value="";var a={channelData:{pageUrl:window.location.href,clientTimestamp:n},text:t,textFormat:"plain",type:"message",channelId:"webchat",from:this.user,timestamp:n,entities:[{requiresBotState:!0,supportsListening:!0,supportsTts:!0,type:"ClientCapabilities"}]};o&&(a.value=o),e&&(a.channelData.messageBack={displayText:e}),this.sendActivity(a),this.shouldDisableBargeIn&&this.disableUserInput()}},this.showErrorMessage=function(t,e){var o=this;e=void 0!==e?e:1e4;o.setEventBarMessage(t);var n=document.querySelector("#zammoBotUIComponent--chatEventBar");n.className=ZammoBotUIKit.addClass(n.className,"has-error"),o.displayEventBar(),e>0&&setTimeout((function(){o.hideEventBar(),n.className=ZammoBotUIKit.removeClass(n.className,"has-error"),o.setEventBarMessage("")}),e)},this.isValidSpeechToken=function(t){return t&&t.tokenExpiration>(new Date).getTime()},this.processSpeechTokenInfo=function(t,e,o){var n=this;t?(n.speechTokenInfo={token:t,region:e,tokenExpiration:(new Date).getTime()+ZammoBotUIKit.constants.SPEECH_TOKEN_EXPIRATION_TIME_IN_MS},setTimeout((function(){n.getSpeechTokenInfo((function(){}))}),ZammoBotUIKit.constants.SPEECH_TOKEN_EXPIRATION_TIME_IN_MS),o({isSuccess:!0,token:t,region:e})):o({isSuccess:!1,reason:"could not retrieve a new valid authentication token"})},this.getSpeechTokenInfo=function(t){var e=this;e.speechTokenInfo&&e.isValidSpeechToken(e.speechTokenInfo)?t({isSuccess:!0,token:e.speechTokenInfo.token,region:e.speechTokenInfo.region}):e.simulatorToken?ZammoBotUIKit.makeHTTPCall(e.zammoApiBaseUrl+"/api/simulator/webchat/speech/session?simulatorToken="+e.simulatorToken,(function(o){e.processSpeechTokenInfo(o.speechToken,o.speechRegion,t)})):ZammoBotUIKit.makeHTTPCall(e.zammoApiBaseUrl+"/api/webchat/speech-token/"+e.webChatId,(function(o){e.processSpeechTokenInfo(o.authorizationToken,o.region,t)}))},this.startSpeechRecognition=function(t,e,o){var n=this,a=window.SpeechSDK.SpeechConfig.fromAuthorizationToken(t,e);a.speechRecognitionLanguage=n.lastMessageLocale;var i=window.SpeechSDK.AudioConfig.fromDefaultMicrophoneInput();n.recognizer=new window.SpeechSDK.SpeechRecognizer(a,i),n.recognizer.recognizeOnceAsync((function(t){switch(n.recognizer.close(),t.reason){case window.SpeechSDK.ResultReason.RecognizedSpeech:o({isSuccess:!0,result:t.text});break;case window.SpeechSDK.ResultReason.NoMatch:o({isSuccess:!1,reason:"Speech could not be recognized."});break;case window.SpeechSDK.ResultReason.Canceled:const e=SpeechSDK.CancellationDetails.fromResult(t);n.logger.log("CANCELED: Reason="+e.reason),o({isSuccess:!1,reason:"CANCELED: Reason="+e.reason}),e.reason==window.SpeechSDK.CancellationReason.Error&&(n.logger.log("CANCELED: ErrorCode="+e.ErrorCode),n.logger.log("CANCELED: ErrorDetails="+e.errorDetails),n.logger.log("CANCELED: Did you set the speech resource key and region values?"));break;default:o({isSuccess:!1,reason:"UNKNOWN: Unknown error."})}}),(function(t){n.logger.log("recognizeOnceAsync","err",t),n.recognizer.close(),o({isSuccess:!1,reason:t})}))},this.toggleContextualMenuOptions=function(){this.chatExtensionMenuOptions&&("block"===window.getComputedStyle(this.chatExtensionMenuOptions).display?this.chatExtensionMenuOptions.style.display="none":this.chatExtensionMenuOptions.style.display="block")},this.addExtensionMenuOption=function(t,e,o,n){if(this.chatExtensionMenuOptions){var a=this,i=document.querySelector("#"+o);if(!i){var s=n?'aria-label="'+n+'"':"",r='<button id="'+(o=o||"zammoBotUIComponent--chatFrame--header--extension-menu--options--"+ZammoBotUIKit.uuidv4())+'" '+s+">"+t+"</button>";a.chatExtensionMenuOptions.insertAdjacentHTML("beforeend",r);var c=document.querySelector("#"+o);c&&c.addEventListener("click",(function(t){t.preventDefault(),e(o),a.toggleContextualMenuOptions()})),a.chatExtensionMenu&&(a.chatExtensionMenu.className=ZammoBotUIKit.removeClass(a.chatExtensionMenu.className,"zammoBotUIComponent--chatFrame--header--extension-menu--hidden"));var m=document.querySelector("#zammoBotUIComponent--chatFrame--header--extension-menu--options--refresh-session-button");return m&&(m.className=ZammoBotUIKit.removeClass(m.className,"zammoBotUIComponent--chatFrame--header--extension-menu--hidden")),o}i.innerHTML=t,n&&i.setAttribute("aria-label",n),e&&ZammoBotUIKit.recreateNode(i).addEventListener("click",(function(t){t.preventDefault(),e(o),a.toggleContextualMenuOptions()}))}},this.setProperties=function(){this.chatFrame=document.getElementById("zammoBotUIComponent--chatFrame"),this.chatIcon=document.getElementById("zammoBotUIComponent--chatIcon"),this.chatIconIcon=document.getElementById("zammoBotUIComponent--chatIcon--icon"),this.chatWindow=document.getElementById("zammoBotUIComponent--chatFrame--chat"),this.chatWindowHeader=document.getElementById("zammoBotUIComponent--chatFrame--header"),this.chatWindowClosingIcon=document.getElementById("zammoBotUIComponent--chatFrame--header--closeIcon"),this.chatInput=document.querySelector(".msger-input"),this.chatArea=document.querySelector(".msger-chat"),this.chatInputForm=document.querySelector(".msger-inputarea"),this.chatInputSendButton=document.querySelector(".msger-send-btn"),this.chatInputMicrophoneButton=document.querySelector("#zammoBotUIComponent--chatFrame--microphone"),this.chatExtensionMenu=document.querySelector("#zammoBotUIComponent--chatFrame--header--extension-menu"),this.chatExtensionMenuButton=document.querySelector("#zammoBotUIComponent--chatFrame--header--extension-menu--icons"),this.chatExtensionMenuOptions=document.querySelector("#zammoBotUIComponent--chatFrame--header--extension-menu--options"),this.chatExtensionMenuOptionRefreshSession=document.querySelector("#zammoBotUIComponent--chatFrame--header--extension-menu--options--refresh-session-button");var t=this;this.chatInput&&this.chatInput.addEventListener("keydown",(function(e){13==e.keyCode&&(e.preventDefault(),t.processUserInput(t.chatInput.value))})),this.chatInputSendButton&&this.chatInputSendButton.addEventListener("click",(function(e){e.preventDefault(),t.processUserInput(t.chatInput.value)})),this.chatInputMicrophoneButton&&this.chatInputMicrophoneButton.addEventListener("click",(function(e){e.preventDefault(),t.isProcessingMicrophoneInput?t.recognizer&&(t.recognizer.close(),t.chatInputMicrophoneButton.className=ZammoBotUIKit.removeClass(t.chatInputMicrophoneButton.className,"speech-processing"),t.isProcessingMicrophoneInput=!1):t.getSpeechTokenInfo((function(e){e.isSuccess?(t.isProcessingMicrophoneInput=!0,t.chatInputMicrophoneButton.className=ZammoBotUIKit.addClass(t.chatInputMicrophoneButton.className,"speech-processing"),t.startSpeechRecognition(e.token,e.region,(function(e){t.isProcessingMicrophoneInput=!1,t.chatInputMicrophoneButton.className=ZammoBotUIKit.removeClass(t.chatInputMicrophoneButton.className,"speech-processing"),e.isSuccess?t.processUserInput(e.result):t.showErrorMessage(e.reason)}))):t.showErrorMessage(recognitionResult.reason)}))})),this.chatExtensionMenuButton&&(this.chatExtensionMenuButton.addEventListener("click",(function(e){e.preventDefault(),t.toggleContextualMenuOptions()})),this.chatExtensionMenuButton.addEventListener("keydown",(function(e){13==e.keyCode&&(e.preventDefault(),t.toggleContextualMenuOptions())}))),this.chatExtensionMenuOptionRefreshSession&&this.chatExtensionMenuOptionRefreshSession.addEventListener("click",(function(e){e.preventDefault(),t.socket&&t.socket.close&&t.socket.close(),t.clearChatHistory(),t.resetSession()}))},this.closeChat=function(){this.announceHook(ZammoBotUIKit.ChatWidgetHooks.START_CLOSING_CHATBOT)&&(this.chatFrame.className=ZammoBotUIKit.removeClass(this.chatFrame.className,"is-visible"),this.chatIcon.className=ZammoBotUIKit.removeClass(this.chatIcon.className,"is-hidden"),ZammoBotUIKit.storage().setStayOpen(!1),this.announceHook(ZammoBotUIKit.ChatWidgetHooks.END_CLOSING_CHATBOT))},this.getSimulatorSessionInfo=function(t){var e=this;ZammoBotUIKit.makeHTTPCall(e.zammoApiBaseUrl+"/api/simulator/webchat/session?simulatorToken="+e.simulatorToken+"&userId="+e.user.id,(function(e){t({isSuccess:!0,simulatorSessionInfo:e})}),"GET",{},{Accept:"application/json"},(function(o){e.logger.log("getSimulatorSessionInfo","makeHTTPCallErr",o),t({isSuccess:!1,error:o})}))},this.setFocusOnChatInput=function(){var t=this;t.chatInput&&setTimeout((function(){t.chatInput.focus()}),200)},this.addExtensionMenuOptionDownloadTranscript=function(){var t=this,e="zammoBotUIComponent--chatFrame--header--extension-menu--options--download-session",o=e+"--format-txt",n=new ZammoBotUIKit.ZammoBotUIModal({title:"<h2>Want a copy of this chat?</h2>",body:'<div id="zammoBotUIComponent--chatFrame--header--extension-menu--options--download-session--content"><span><input type="radio" id="zammoBotUIComponent--chatFrame--header--extension-menu--options--download-session--format-txt" name="download-format" value="format-txt" checked><label for="zammoBotUIComponent--chatFrame--header--extension-menu--options--download-session--format-txt">Raw text format</label></span></div>',confirmButtonLabel:"Download",onConfirmButtonClick:function(){var e=document.querySelector("#"+o),n=document.querySelector("#zammoBotUIComponent--chatFrame--header--extension-menu--options--download-session--format-pdf");ZammoBotUIKit.makeHTTPCall(t.directLineUrl+"/conversations/"+t.conversation.conversationId+"/activities?",(function(o){if(t.logger.log("ZammoBotUIKit.ZammoBotUI.checkConnection::","the existing conversation response is",o),transcript="",e.checked&&o.activities){for(var a=o.activities,i=0;i<a.length;i++){var s=a[i],r=new Date(s.timestamp).toLocaleString();s&&"message"===s.type&&(s.from.id!==t.user.id?transcript=transcript+"["+r+" | Virtual Agent]: ":transcript=transcript+"["+r+" | You]: ",transcript=transcript+s.text+"\n\n")}ZammoBotUIKit.isNullOrEmpty(transcript)||(c="discussion-with-virtual-agent-"+(new Date).toLocaleString(),m=transcript,(l=document.createElement("a")).setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(m)),l.setAttribute("download",c),l.style.display="none",document.body.appendChild(l),l.click(),document.body.removeChild(l))}else n.checked;var c,m,l}),"GET",null,{Authorization:"Bearer "+t.conversation.token,"Content-Type":"application/json"})},styles:[{selector:"#zammoBotUIComponent--chatFrame--header--extension-menu--options--download-session--content",content:"display: flex;flex-direction: column;margin-bottom: 5%;"},{selector:"#zammoBotUIComponent--chatFrame--header--extension-menu--options--download-session--content span",content:"margin-bottom: 5%;"}]});t.shouldAllowUserToDownloadTranscript&&t.addExtensionMenuOption("Download chat transcript",(function(){t.chatFrame.id&&n.displayModal("#"+t.chatFrame.id)}),e)},this.openChat=function(){var t=ZammoBotUIKit.storage();if(t.setStayOpen(!0),this.announceHook(ZammoBotUIKit.ChatWidgetHooks.START_OPENING_CHATBOT)){var e=this;if(e.isFirstOpening&&!e.offlineMode){e.appendTyping(),this.disableUserInput();var o=t.getConversationId(),n=t.getConversationToken();o&&"undefined"!==o&&n&&"undefined"!==n?(e.conversation={token:n,id:o},e.checkConnection((function(){e.isFirstOpening=!1}),!0)):e.simulatorToken?e.connectNew((function(){e.isFirstOpening=!1}),!0):ZammoBotUIKit.makeHTTPCall(e.zammoApiBaseUrl+"/api/webchat/token/"+e.webChatId+"/"+e.user.id,(function(t){e.logger.log("ZammoBotUIKit.ZammoBotUI.run::","the api response is",t);var o=t.conversationId;e.conversation={token:t.token,id:o},e.checkConnection((function(){e.isFirstOpening=!1}),!0)}))}this.addExtensionMenuOptionDownloadTranscript(),this.chatFrame.className=ZammoBotUIKit.addClass(this.chatFrame.className,"is-visible"),this.chatIcon.className=ZammoBotUIKit.addClass(this.chatIcon.className,"is-hidden"),this.setFocusOnChatInput(),this.announceHook(ZammoBotUIKit.ChatWidgetHooks.END_OPENING_CHATBOT)}},this.isChatOpen=function(){return-1!==this.chatFrame.className.indexOf("is-visible")},this.setCommands=function(){var t=this;this.chatIcon.onclick=function(e){e.preventDefault(),t.isChatOpen()?t.closeChat():t.openChat()},this.chatWindowClosingIcon&&(this.chatWindowClosingIcon.onclick=function(e){e.preventDefault(),t.closeChat()})},this.appendAgentTyping=function(){if(this.removeTyping(),this.removeAgentTyping(),!document.querySelector(".msg-typing-agent")){var t="agent-typing-"+(new Date).getTime().toString(),e=`<div class="msg-typing-agent" id="${t}"></div>`;this.chatArea.insertAdjacentHTML("beforeend",e),this.chatArea.scrollTop+=500,setTimeout((function(){var e=document.querySelectorAll("#"+t);if(e)for(var o=0;o<e.length;o++)e[o].remove()}),6e4)}},this.removeAgentTyping=function(){var t=document.querySelectorAll(".msg-typing-agent");if(t)for(var e=0;e<t.length;e++)t[e].remove()},this.appendTyping=function(){if(!document.querySelector(".msg-typing")){this.chatArea.insertAdjacentHTML("beforeend",'<div class="msg-typing"></div>'),this.chatArea.scrollTop+=500}},this.removeTyping=function(){var t=document.querySelectorAll(".msg-typing");if(t)for(var e=0;e<t.length;e++)t[e].remove()},this.removeSuggestedActions=function(){var t=document.querySelectorAll(".msg-suggested-actions-carousel-container");if(t)for(var e=0;e<t.length;e++)t[e].remove()},this.bindSuggestedActions=function(t){if(t&&0!==t.length)for(var e=this,o=document.querySelectorAll(".msg-button-div"),n=0;n<o.length;n++)o[n].onclick=function(){var t=this.getAttribute("action-type"),o=this.getAttribute("action-value"),n=this.getAttribute("action-display-text"),a=this.getAttribute("action-text");t===ZammoBotUIKit.CardActionTypes.MESSAGE_BACK?e.processUserInput(a,n,o):e.processUserInput(o)}},this.getSuggestedActionsHTML=function(t){if(!t||0===t.length)return"";for(var e=['<div class="msg-suggested-actions">'],o=0;o<t.length;o++){var n=t[o].title?t[o].title:t[o].text?t[o].text:t[o].value;e.push('<div class="msg-button-div" action-text="'+t[o].text+'" action-type="'+t[o].type+'" action-display-text="'+t[o].displayText+'" action-value="'+t[o].value+'">'+n+"</div>")}return e.push("</div>"),'<div class="msg-suggested-actions-carousel-container" style="width:80%; margin-top: 3%;"><div class="msg-suggested-actions-chips-container" style="position: relative;">'+e.join("\n")+"</div></div>"},this.bindCardActions=function(){var t=this,e=document.querySelectorAll(".mdc-button");if(e)for(var o=0;o<e.length;o++)e[o].onclick=function(){var e=this.getAttribute("card-action-type"),o=this.getAttribute("card-action-text"),n=this.getAttribute("card-action-display-text"),a=this.getAttribute("card-action-value");switch(e){case ZammoBotUIKit.CardActionTypes.SIGN_IN:case ZammoBotUIKit.CardActionTypes.OPEN_URL:return ZammoBotUIKit.openInNewTab(a);case ZammoBotUIKit.CardActionTypes.IM_BACK:return t.processUserInput(a);case ZammoBotUIKit.CardActionTypes.MESSAGE_BACK:return t.processUserInput(o,n,a)}}},this.bindAdaptiveCards=function(t){this.adaptiveCardsToBind||(this.adaptiveCardsToBind=[]);for(var e=0;e<this.adaptiveCardsToBind.length;e++){var o=this.adaptiveCardsToBind[e],n=o.id,a=o.data;if(n&&a){var i=t.querySelector("#"+n);i&&i.parentNode.replaceChild(a,i)}}this.adaptiveCardsToBind=[]},this.appendEvent=function(t){var e="the bot said at "+ZammoBotUIKit.formatDate(new Date);this.removeSuggestedActions();var o='<section class="event"><span class="sr-only">'+e+"</span>"+t+"</section>";this.chatArea.insertAdjacentHTML("beforeend",o),this.chatArea.scrollTop=this.chatArea.scrollHeight},this.appendSystemMessage=function(t){var e="the system said at "+ZammoBotUIKit.formatDate(new Date);this.removeSuggestedActions();var o='<section class="systemmessage"><span class="sr-only">'+e+"</span>"+t+"</section>";this.chatArea.insertAdjacentHTML("beforeend",o),this.chatArea.scrollTop=this.chatArea.scrollHeight},this.scrollChatAreaToMessage=function(t){var e=this;setTimeout((function(){t||(e.chatArea.scrollTop=e.chatArea.scrollHeight)}),100)},this.appendMessage=function(t,e,o,n,a){if(this.stickyChat){var i=localStorage.getItem(ZammoBotUIKit.constants.REPLAY_MESSAGES_LOCAL_STORAGE_KEY),s=[];try{i&&(s=JSON.parse(i))}catch{}var r=ZammoBotUIKit.cyrb53(t+o);s.find(t=>t.id===r)||(s.push({id:r,side:t,text:e,date:o,suggestedActions:n,attachments:a}),localStorage.setItem(ZammoBotUIKit.constants.REPLAY_MESSAGES_LOCAL_STORAGE_KEY,JSON.stringify(s)))}if(n=void 0!==n?n:null,a=void 0!==a?a:null,e||n||a){this.removeSuggestedActions();var c=this.getSuggestedActionsHTML(n),m=ZammoBotUIKit.AttachmentService.getAttachmentsHTML(a,this),l=ZammoBotUIKit.getFuzzyTime(new Date(o)),d='<div class="msg-bubble"><section class="msg-text"><span class="sr-only">'+(("left"===t?"the bot":"you")+" said at "+l.fuzzyTime)+'</span><span class="text-content">'+(ZammoBotUIKit.isset(e)?e:"")+"</span></section>"+m+'<div aria-hidden="true" class="msg-info"><div class="msg-info-time">'+l.exactTime+"</div></div></div>"+c,u=document.createElement("div");u.setAttribute("tabindex","0"),u.setAttribute("class","msg "+t+"-msg"),u.innerHTML=d,this.bindAdaptiveCards(u),this.chatArea.appendChild(u),this.chatArea.scrollTop=this.chatArea.scrollHeight,this.bindSuggestedActions(n),this.bindCardActions()}},this.createFileUploadArea=function(t,e,o,n,a){var i=this,s=(new Date).getTime(),r="drop"+s,c="file"+s,m="choose"+s,l="button"+s,d="fileInfo"+s,u="uploading"+s,h="error"+s,p='<div id="'+r+'" class="drop-area"><p>'+t+'</p><input type="file" id="'+c+'" multiple hidden /><label id="'+m+'" class="mdc-button choose-button" for="'+c+'"><div class="mdc-button__ripple"></div><span class="">'+e+'</span></label><p id="'+d+'"></p><p id="'+h+'" class="error hide"></p><button id="'+l+'" class="mdc-button send-button hide"><div class="mdc-button__ripple"></div><span class="">'+o+'</span></button><p id="'+u+'" class="loading hide">'+n+"</p></div>";this.chatArea.insertAdjacentHTML("beforeend",p);var g=document.querySelectorAll("#"+r)[0],I=document.querySelectorAll("#"+l)[0],v=document.querySelectorAll("#"+m)[0],f=document.querySelectorAll("#"+c)[0],B=document.querySelectorAll("#"+d)[0],y=document.querySelectorAll("#"+u)[0],U=document.querySelectorAll("#"+h)[0];function C(){S();for(var t="<ul>",e=0;e<f.files.length;e++)t+="<li>"+f.files[e].name+"</li>";t+="</ul>",B.innerHTML=t,f.files.length>0?(I.classList.remove("hide"),i.scrollChatAreaToMessage()):A()}function T(t){t.preventDefault(),t.stopPropagation()}function S(){U.innerHTML="",U.className=ZammoBotUIKit.addClass(U.className,"hide")}function b(){y.classList.add("hide")}function A(){I.classList.add("hide")}function w(t){g.classList.add("highlight")}function Z(t){g.classList.remove("highlight")}f.addEventListener("change",(function(t){C()})),["dragenter","dragover","dragleave","drop"].forEach((function(t){g.addEventListener(t,T,!1)})),["dragenter","dragover"].forEach((function(t){g.addEventListener(t,w,!1)})),["dragleave","drop"].forEach((function(t){g.addEventListener(t,Z,!1)})),g.addEventListener("drop",(function(t){var e=t.dataTransfer;f.files=e.files,C()}),!1),I.addEventListener("click",(function(t){return S(),A(),v.classList.add("hide"),y.classList.remove("hide"),t.preventDefault(),i.checkConnection((function(){ZammoBotUIKit.postForm(i.zammoApiBaseUrl+"/api/attachment-upload/"+i.webChatId+"?conversationId="+i.conversation.conversationId+"&userId="+i.user.id,(function(t,e){if(e>=400)s=t,U.innerHTML=s,U.className=ZammoBotUIKit.removeClass(U.className,"hide"),v.classList.remove("hide"),b();else{var o=(new Date).toISOString(),n={channelData:{pageUrl:window.location.href,clientTimestamp:o,postBack:!0},name:"zammoExtendedFileSizeUpload",type:"message",text:a,channelId:"webchat",from:i.user,timestamp:o,entities:[JSON.parse(t)]};b(),i.sendActivity(n),["dragenter","dragover"].forEach((function(t){g.removeEventListener(t,w,!1)})),["dragleave","drop"].forEach((function(t){g.removeEventListener(t,Z,!1)})),["dragenter","dragover","dragleave","drop"].forEach((function(t){g.removeEventListener(t,T,!1)}))}var s}),f,{Authorization:"Bearer "+i.conversation.token},i.user)}),!1),!1})),this.chatArea.scrollTop=this.chatArea.scrollHeight},this.setEventBarMessage=function(t){document.querySelector("#zammoBotUIComponent--chatEventBar span").innerHTML=t},this.displayEventBar=function(){var t=document.querySelector("#zammoBotUIComponent--chatEventBar");this.chatWindow.className=ZammoBotUIKit.removeClass(this.chatWindow.className,"is-event-bar-visible"),t.className=ZammoBotUIKit.removeClass(t.className,"is-event-bar-visible"),this.chatWindow.className=ZammoBotUIKit.addClass(this.chatWindow.className,"is-event-bar-visible"),t.className=ZammoBotUIKit.addClass(t.className,"is-event-bar-visible")},this.hideEventBar=function(){var t=document.querySelector("#zammoBotUIComponent--chatEventBar");this.chatWindow.className=ZammoBotUIKit.removeClass(this.chatWindow.className,"is-event-bar-visible"),t.className=ZammoBotUIKit.removeClass(t.className,"is-event-bar-visible"),this.setEventBarMessage("")},this.handleLocationRequest=function(){var t=this;if(this.displayEventBar(),this.setEventBarMessage("Retrieving location information ..."),navigator&&navigator.geolocation)navigator.geolocation.getCurrentPosition((function(e){t.setEventBarMessage("Sending location back to the bot ...");var o={IsSuccess:!0,Latitude:e.coords.latitude,Longitude:e.coords.longitude,Reason:""},n={text:JSON.stringify(o),type:ZammoBotUIKit.constants.customActivityType.ZammoSubmitLocation,channelId:"directline",from:t.user};t.sendActivity(n)}),(function(){t.setEventBarMessage("Sending location back to the bot ...");var e={text:JSON.stringify({IsSuccess:!1,Reason:"user denied to share their location"}),type:ZammoBotUIKit.constants.customActivityType.ZammoSubmitLocation,channelId:"directline",from:t.user};t.sendActivity(e)}));else{t.setEventBarMessage("Sending location back to the bot ...");var e={text:JSON.stringify({IsSuccess:!1,Reason:"the location isn't available on the user's browser"}),type:ZammoBotUIKit.constants.customActivityType.ZammoSubmitLocation,channelId:"directline",from:t.user};t.sendActivity(e)}},this.processWebsocketMessage=function(t){var e=this;try{var o=JSON.parse(t);if(o.activities&&o.activities.length>0){var n=o.activities[o.activities.length-1];if(this.messages[n.id])return void this.logger.log("ZammoBotUIKit.ZammoBotUI.processWebsocketMessage","discarding already processed",this.messages,t);if(this.messages[n.id]=42,this.logger.log("ZammoBotUIKit.ZammoBotUI.processWebsocketMessage","activity",n),e.stickyChat){var a=localStorage.getItem(ZammoBotUIKit.constants.TRACKED_ACTIVITIES_LOCAL_STORAGE_KEY),i=[];if(a&&(i=JSON.parse(a)),i.find(t=>t===n.id))return;i.push(n.id),localStorage.setItem(ZammoBotUIKit.constants.TRACKED_ACTIVITIES_LOCAL_STORAGE_KEY,JSON.stringify(i))}if(this.lastMessageLocale=n.locale?n.locale:this.lastMessageLocale,!e.announceHook(ZammoBotUIKit.ChatWidgetHooks.START_PROCESSING_CHATBOT_ACTIVITY,n))return;for(var s=0;s<ZammoBotUIKit.Extensions.length;s++){var r=ZammoBotUIKit.Extensions[s];if(r.canHandleInbound(n,e))return void r.handleInbound(n,e,this.logger)}if((e.simulatorToken||e.shouldIgnoreUiBuilderIgnore)&&n.channelData&&n.channelData.UiBuilderIgnore)return;if("message"===n.type&&n.from&&n.from.id!==this.user.id){this.logger.log("ZammoBotUIKit.ZammoBotUI.processWebsocketMessage","activity.timestamp",n.timestamp),this.removeTyping(),this.removeAgentTyping(),this.hideEventBar(),this.hasReceivedAMessage=!0;var c=ZammoBotUIKit.isset(n.text)?ZammoBotUIKit.getHTMLFromMarkdown(n.text):"",m=n.suggestedActions&&n.suggestedActions.actions?n.suggestedActions.actions:null,l=n.attachments?n.attachments:null;if(this.appendMessage("left",c,n.timestamp,m,l),n.channelData&&n.channelData.FileDialogPrompt&&this.createFileUploadArea(n.channelData.DataLabels.InstructionText,n.channelData.DataLabels.ChooseFilesText,n.channelData.DataLabels.SendText,n.channelData.DataLabels.UploadingText,n.channelData.DataLabels.FilesUploadedText),e.shouldDisableBargeIn)n&&n.inputHint&&"expectingInput"===n.inputHint&&e.enableUserInput(),e.timeoutWheToEnableUserInputAgain&&clearTimeout(this.timeoutWheToEnableUserInputAgain),e.timeoutWheToEnableUserInputAgain=setTimeout((function(){e.enableUserInput()}),1500);else try{e.enableUserInput()}catch(t){e.logger.log("processWebsocketMessage","err",t)}}if("message"===n.type&&n.from&&n.from.id===this.user.id){this.logger.log("activity.timestamp",n.timestamp),this.removeTyping(),this.hasReceivedAMessage=!1;var d=ZammoBotUIKit.get(n,"channelData.messageBack.displayText",n.displayText);c=ZammoBotUIKit.isset(d)?d:ZammoBotUIKit.isset(n.text)?n.text:"";c=HtmlSanitizer.SanitizeHtml(c);m=n.suggestedActions&&n.suggestedActions.actions?n.suggestedActions.actions:null,l=n.attachments?n.attachments:null;this.appendMessage("right",c,n.timestamp,m,l)}"event"===n.type&&"handoff.initiate"===n.name&&n.from&&n.from.id!==e.user.id&&(this.removeTyping(),this.appendEvent("You are in a queue for agent chat, one moment please.")),"event"===n.type&&"zammo.agentjoined"===n.name&&n.from&&n.from.id!==e.user.id&&(this.removeTyping(),this.appendEvent(n.text)),"event"===n.type&&"zammo.agentleft"===n.name&&n.from&&n.from.id!==e.user.id&&(this.removeTyping(),this.appendEvent(n.text)),"event"===n.type&&"zammo.systemmessage"===n.name&&(this.removeTyping(),this.appendSystemMessage(n.text)),"event"===n.type&&"zammo.agenttyping"===n.name&&this.appendAgentTyping(),"typing"===n.type&&this.appendTyping(),n.type===ZammoBotUIKit.constants.customActivityType.ZammoRequestLocation&&(this.removeTyping(),this.handleLocationRequest()),e.announceHook(ZammoBotUIKit.ChatWidgetHooks.END_PROCESSING_CHATBOT_ACTIVITY,n)}}catch(e){this.logger.error("ZammoBotUIKit.ZammoBotUI.processWebsocketMessage","discarding",t,"because of",e)}},this.setConversationInformation=function(t,e){e=void 0!==e?e:null,this.conversation=t;if(!this.offlineMode){if(t){var o=ZammoBotUIKit.storage();o.setConversationId(t.conversationId),o.setConversationToken(t.token),o.setHasStarted(!0)}ZammoBotUIKit.isWebSocketSupported(t.streamUrl,this.logger)?this.setConversationInformationWithSocket(e):this.setConversationInformationWithPolling()}},this.setConversationInformationWithPolling=function(){var t=this;setTimeout((function(){ZammoBotUIKit.makeHTTPCall(t.directLineUrl+"/conversations/"+t.conversation.conversationId+"/activities?watermark="+t.conversation.watermark,(function(e){t.logger.log("ZammoBotUIKit.ZammoBotUI.checkConnection::","the existing conversation response is",e),t.conversation.watermark=e.watermark,t.processWebsocketMessage(JSON.stringify(e)),t.setConversationInformationWithPolling(t.conversation)}),"GET",null,{Authorization:"Bearer "+t.conversation.token,"Content-Type":"application/json"})}),1e3*ZammoBotUIKit.constants.ACTIVITIES_POLLING_INTERVAL)},this.setConversationInformationWithSocket=function(t){var e=this;this.socket=new WebSocket(e.conversation.streamUrl),this.socket.addEventListener("open",(function(o){e.logger.log("ZammoBotUIKit.ZammoBotUI.setConversationInformation::","the connection is opened",o),t&&t()})),this.socket.addEventListener("message",(function(t){e.logger.log("ZammoBotUIKit.ZammoBotUI.setConversationInformation::","message from the server ws",t),ZammoBotUIKit.IsStrAValidJson(t.data)?e.processWebsocketMessage(t.data):e.logger.log("ZammoBotUIKit.ZammoBotUI.setConversationInformation::","the message from the server was ignored since data is not an object",t)})),this.socket.addEventListener("close",(function(t){e.logger.log("ZammoBotUIKit.ZammoBotUI.setConversationInformation::","connection has been closed",t),e.socket=null})),this.socket.addEventListener("error",(function(t){e.logger.log("ZammoBotUIKit.ZammoBotUI.setConversationInformation::","connection had an error",t),e.socket=null}))},this.initializeDirectLineConversation=function(t,e,o){var n=this;ZammoBotUIKit.makeHTTPCall(n.directLineUrl+"/conversations",(function(t){n.logger.log("ZammoBotUIKit.ZammoBotUI.initializeDirectLineConversation::","the create conversation response is",t),n.setConversationInformation(t,e&&o?o:null),!e&&o&&o()}),"POST",JSON.stringify({locale:"en-US"}),{Authorization:"Bearer "+t,"Content-Type":"application/json"})},this.connectNew=function(t,e){var o=this;o.simulatorToken?(o.logger.log("connectNew will use the simulator token","zammoBotUIInstance.simulatorToken",o.simulatorToken),o.getSimulatorSessionInfo((function(n){n.isSuccess?(o.logger.log("connectNew:: directline token successfuly retrieved for simulator","getSimulatorSessionInfoResult",n),o.initializeDirectLineConversation(n.simulatorSessionInfo.directLineToken,e,(function(){e&&(o.logger.log("connectNew:: will send the launch activity for the simulator"),o.sendActivity({from:o.user,type:"event",text:"launch",entities:[{type:"SimulatorConfig",value:{token:o.simulatorToken,isChat:!0,isTryZammoWebchat:!0}}]})),t&&t()}))):(o.removeTyping(),o.showErrorMessage(n.error,-42))}))):(o.logger.log("connectNew will use the webachat ID","zammoBotUIInstance.webChatId",o.webChatId,"zammoBotUIInstance.user.id",o.user.id),ZammoBotUIKit.makeHTTPCall(o.zammoApiBaseUrl+"/api/webchat/token/"+o.webChatId+"/"+o.user.id,(function(n){o.tokenApiResponse=n,o.initializeDirectLineConversation(n.token,e,t)})))},this.connectExisting=function(t,e){var o=this;o.conversation&&o.conversation.id?ZammoBotUIKit.makeHTTPCall(o.directLineUrl+"/conversations/"+o.conversation.id+"?watermark=-",(function(n){n.token?(o.logger.log("ZammoBotUIKit.ZammoBotUI.connectExisting::","connected. the existing conversation response is",n),o.setConversationInformation(n,e&&t?t:null),!e&&t&&t()):(o.logger.log("ZammoBotUIKit.ZammoBotUI.connectExisting::","conversation expired, starting new conversation. the existing conversation response is",n),o.connectNew(t,e))}),"GET",null,{Authorization:"Bearer "+o.conversation.token,"Content-Type":"application/json"},(function(n){o.logger.log("ZammoBotUIKit.ZammoBotUI.connectExisting::","failed to connect to the existing conversation. Response is:",n);var a=new ZammoBotUIKit.ZammoBotUIModal({title:'<h2><i class="material-icons" >sentiment_very_dissatisfied</i></h2>',body:"<p>Oops, your conversation with the chatbot has expired.</p><p>No worries! You can start a new one.</p><p>As you begin the new conversation, you can keep or clear the chat history.</p><p><b>Note</b>: Clearing the chat will remove the history permanently.</p>",confirmButtonLabel:"Keep",onConfirmButtonClick:function(){o.disableUserInput(),o.connectNew(t,e),o.appendTyping(),a.close()},showCancelButton:!0,cancelButtonLabel:"Clear",onCancelButtonClick:function(){o.clearChatHistory(),o.resetSession(t,e),a.close()},styles:[]});o.chatFrame.id&&a.displayModal("#"+o.chatFrame.id)})):console.error("you're attempting to perform actions on a conversation that doesn't exist. You can verifiy previous error messages or contact your Zammo administrators.")},this.reconnect=function(t,e){var o=this;o.conversation&&o.conversation.conversationId?ZammoBotUIKit.makeHTTPCall(o.directLineUrl+"/conversations/"+o.conversation.conversationId+"?watermark=-",(function(n){n.token?(o.logger.log("ZammoBotUIKit.ZammoBotUI.reconnect::","connected. the existing conversation response is",n),o.setConversationInformation(n,e&&t?t:null),!e&&t&&t()):(o.logger.log("ZammoBotUIKit.ZammoBotUI.reconnect::","conversation expired, starting new conversation. the existing conversation response is",n),o.connectNew(t,e))}),"GET",null,{Authorization:"Bearer "+o.conversation.token,"Content-Type":"application/json"}):console.error("you're attempting to perform actions on a conversation that doesn't exist. You can verifiy previous error messages or contact your Zammo administrators.")},this.checkConnection=function(t,e){e=void 0!==e&&e;var o=ZammoBotUIKit.storage().getHasStarted();this.stickyChat&&!this.conversation.conversationId&&this.conversation.id&&this.conversation.token&&o?(this.logger.log("ZammoBotUIKit.ZammoBotUI.checkConnection::","connect to an exiting conversation. conversation is sticky and has started"),this.connectExisting(t,e)):this.conversation&&this.conversation.conversationId?!this.socket&&this.conversation&&this.conversation.conversationId?(this.logger.log("ZammoBotUIKit.ZammoBotUI.checkConnection::","reconnect to an existing connection."),this.reconnect(t,e)):t&&t():(this.logger.log("ZammoBotUIKit.ZammoBotUI.checkConnection::","connect to a new conversation."),this.connectNew(t,e))},this.sendActivity=function(t,e){for(var o=this,n=0;n<ZammoBotUIKit.Extensions.length;n++){var a=ZammoBotUIKit.Extensions[n];if(a.canHandleOutbound(t,o))return void a.handleOutbound(t,o,this.logger)}e=void 0!==e&&e,this.checkConnection((function(){o.logger.log("ZammoBotUIKit.ZammoBotUI.sendActivity::","will post the activity",t),o.conversation&&o.conversation.conversationId?ZammoBotUIKit.makeHTTPCall(o.directLineUrl+"/conversations/"+o.conversation.conversationId+"/activities",(function(t){o.logger.log("ZammoBotUIKit.ZammoBotUI.sendActivity::",t)}),"POST",JSON.stringify(t),{Authorization:"Bearer "+o.conversation.token,"Content-Type":"application/json"}):console.error("you're attempting to perform actions on a conversation that doesn't exist. You can verifiy previous error messages or contact your Zammo administrators.")}),e)},this.clearChatHistory=function(){if(this.chatArea)for(;this.chatArea.firstChild;)this.chatArea.removeChild(this.chatArea.firstChild)},this.replayExistingActivities=function(){this.logger.log("ZammoBotUIKit.ZammoBotUI.replayExistingActivities::","will replay locally stored activities.");var t=localStorage.getItem(ZammoBotUIKit.constants.REPLAY_MESSAGES_LOCAL_STORAGE_KEY),e=[];try{t&&(e=JSON.parse(t))}catch{}this.logger.log("ZammoBotUIKit.ZammoBotUI.replayExistingActivities::","will replay locally stored",e.length,"activities.");for(var o=0;o<e.length;o++){var n=e[o];this.appendMessage(n.side,n.text,n.date,n.suggestedActions,n.attachments)}},this.clearStickyLocalStorageInfo=function(){localStorage.getItem(ZammoBotUIKit.constants.REPLAY_MESSAGES_LOCAL_STORAGE_KEY)&&localStorage.removeItem(ZammoBotUIKit.constants.REPLAY_MESSAGES_LOCAL_STORAGE_KEY),localStorage.getItem(ZammoBotUIKit.constants.TRACKED_ACTIVITIES_LOCAL_STORAGE_KEY)&&localStorage.removeItem(ZammoBotUIKit.constants.TRACKED_ACTIVITIES_LOCAL_STORAGE_KEY)},this.resetSession=function(t,e){e||(e=!0);this.clearStickyLocalStorageInfo(),this.disableUserInput(),this.connectNew(t,e),this.appendTyping()},this.run=function(t,e){var o=this;o.offlineMode=e,o.loadRequiredStylesAndScripts((function(){ZammoBotUIKit.addViewportIfNotAvailable();var n=o.loadingDivId?document.querySelector("#"+o.loadingDivId):null,a=o.getBotUIComponent(e);n?n.appendChild(a):document.body.appendChild(a),o.setProperties(),o.setCommands(),o.isFirstOpening=!0,o.stickyChat&&ZammoBotUIKit.storage().getStayOpen()?(o.openChat(),o.replayExistingActivities(),o.removeTyping(),o.scrollChatAreaToMessage(),o.enableUserInput()):o.clearStickyLocalStorageInfo(),t&&t()}))}},ZammoBotUIKit.initialize=function(t){var e=document.getElementById("ZammoBotUIKitScript"),o=ZammoBotUIKit.getAttributeOrDefault(e,"cssUrl","zammo-bot-ui-kit.css"),n=ZammoBotUIKit.getAttributeOrDefault(e,"zammoApiBaseUrl","https://localhost:5001"),a=ZammoBotUIKit.getAttributeOrDefault(e,"stickyChat","false"),i=ZammoBotUIKit.getAttributeOrDefault(e,"ttl","3600000"),s=ZammoBotUIKit.getAttributeOrDefault(e,"environment","production"),r=t||e.getAttribute("webchatId"),c=e.hasAttribute("unbranded"),m=ZammoBotUIKit.getAttributeOrDefault(e,"directLineUrl","https://directline.botframework.com/v3/directline"),l=ZammoBotUIKit.getAttributeOrDefault(e,"shouldLoadDependencies","true"),d=ZammoBotUIKit.getAttributeOrDefault(e,"shouldShowMicrophone","false"),u=ZammoBotUIKit.getAttributeOrDefault(e,"shouldShowExtensionMenu","false"),h=ZammoBotUIKit.getAttributeOrDefault(e,"simulatorToken",null),p=ZammoBotUIKit.getAttributeOrDefault(e,"loadingDivId",null),g=ZammoBotUIKit.getAttributeOrDefault(e,"shouldIgnoreUiBuilderIgnore","false"),I=ZammoBotUIKit.getAttributeOrDefault(e,"shouldDisableBargeIn","false"),v=ZammoBotUIKit.getAttributeOrDefault(e,"shouldAllowUserToDownloadTranscript","false");return new ZammoBotUIKit.ZammoBotUI({environment:s,cssUrl:o,zammoApiBaseUrl:n,webChatId:r,stickyChat:a,shouldHideBranding:c,ttlInMilliseconds:i,directLineUrl:m,shouldLoadDependencies:l,shouldShowMicrophone:"true"===d,shouldShowExtensionMenu:"true"===u,simulatorToken:h,loadingDivId:p,shouldIgnoreUiBuilderIgnore:"true"===g,shouldDisableBargeIn:"true"===I,shouldAllowUserToDownloadTranscript:"true"===v})},ZammoBotUIKit.onDocumentReady((function(){var t=document.getElementById("ZammoBotUIKitScript");if(!t||!t.getAttribute("randomUID")){for(var e=document.querySelectorAll("#ZammoBotUIKitScript"),o=0;o<e.length;o++)e[o].setAttribute("randomUID",ZammoBotUIKit.uuidv4());if(t){var n=ZammoBotUIKit.initialize();"standalone"===ZammoBotUIKit.getAttributeOrDefault(t,"executionType","standalone")&&n.run()}else console.error("The Zammo Bot UI Kit is not properly configured, please go to <instruction link>")}})),window.ZammoBotUIKit=ZammoBotUIKit;