/*! Zammo UI KIT JS * v0.4.8\n * Â© Zammo AI with <3  * Build time: 09-16-2022 22:06:29 */ [Element.prototype,CharacterData.prototype,DocumentType.prototype].forEach((function(t){t.hasOwnProperty("remove")||Object.defineProperty(t,"remove",{configurable:!0,enumerable:!0,writable:!0,value:function(){this.parentNode.removeChild(this)}})})),Array.from||(Array.from=function(){var t=Object.prototype.toString,e=function(e){return"function"==typeof e||"[object Function]"===t.call(e)},o=Math.pow(2,53)-1,n=function(t){var e=function(t){var e=Number(t);return isNaN(e)?0:0!==e&&isFinite(e)?(e>0?1:-1)*Math.floor(Math.abs(e)):e}(t);return Math.min(Math.max(e,0),o)};return function(t){var o=this,i=Object(t);if(null==t)throw new TypeError("Array.from requires an array-like object - not null or undefined");var a,s=arguments.length>1?arguments[1]:void 0;if(void 0!==s){if(!e(s))throw new TypeError("Array.from: when provided, the second argument must be a function");arguments.length>2&&(a=arguments[2])}for(var r,c=n(i.length),m=e(o)?Object(new o(c)):new Array(c),l=0;l<c;)r=i[l],m[l]=s?void 0===a?s(r,l):s.call(a,r,l):r,l+=1;return m.length=c,m}}());var ZammoBotUIKit={Extensions:[],constants:{MAX_POLLING_ATTEMPTS:5,POLLING_INTERVAL:5,ACTIVITIES_POLLING_INTERVAL:1,MAX_BUTTONS_PER_LINE:3,ZAMMO_BOT_UI_ID:"zammoBotUIComponent",customActivityType:{ZammoRequestLocation:"ZammoRequestLocation",ZammoSubmitLocation:"ZammoSubmitLocation"},SPEECH_TOKEN_EXPIRATION_TIME_IN_MS:6e5},ChatWidgetHooks:{START_OPENING_CHATBOT:"START_OPENING_CHATBOT",END_OPENING_CHATBOT:"END_OPENING_CHATBOT",START_CLOSING_CHATBOT:"START_CLOSING_CHATBOT",END_CLOSING_CHATBOT:"END_CLOSING_CHATBOT"},defaultAdapativeCardHostConfig:{containerStyles:{default:{foregroundColors:{default:{default:"#000000",subtle:"#767676"},accent:{default:"#0063B1",subtle:"#0078D4"},attention:{default:"#D13438",subtle:"#A4262C"},dark:{default:"#000000",subtle:"#646464"},good:{default:"#0B6A0B",subtle:"#028A02"},light:{default:"#FFFFFF",subtle:"#767676"},warning:{default:"#B75C00",subtle:"#986F0B"}}},emphasis:{backgroundColor:"#f57f17",foregroundColors:{default:{default:"#000000",subtle:"#484644"}}},accent:{backgroundColor:"#C7DEF9",foregroundColors:{default:{default:"#333333",subtle:"#484644"}}},good:{backgroundColor:"#CCFFCC",foregroundColors:{default:{default:"#333333",subtle:"#484644"}}},attention:{backgroundColor:"#FFC5B2",foregroundColors:{default:{default:"#333333",subtle:"#484644"}}},warning:{backgroundColor:"#FFE2B2",foregroundColors:{default:{default:"#333333",subtle:"#484644"}}}},supportsInteractivity:!0,fontFamily:"Montserrat",imageSizes:{small:40,medium:80,large:160},actions:{actionAlignment:"stretch",actionsOrientation:"vertical",buttonSpacing:8,maxActions:100,showCard:{actionMode:"inline",inlineTopMargin:8},spacing:"default"},adaptiveCard:{allowCustomStyle:!1},imageSet:{imageSize:"medium",maxImageHeight:100},factSet:{title:{color:"default",size:"default",isSubtle:!1,weight:"bolder",wrap:!0,maxWidth:150},value:{color:"default",size:"default",isSubtle:!1,weight:"default",wrap:!0},spacing:8}},
/*!
 * Sanitize and encode all HTML in a user-submitted string
 * (c) 2018 Chris Ferdinandi, MIT License, https://gomakethings.com
 * @param  {String} str  The user-submitted string
 * @return {String} str  The sanitized string
 */
sanitizeHTML:function(t){var e=document.createElement("div");return e.textContent=t,e.innerHTML},storage:function(){return{setStayOpen:function(t){window.localStorage&&window.localStorage.setItem("zammo-bot-ui-kit-stay-open",t)},getStayOpen:function(){return!!window.localStorage&&"true"===window.localStorage.getItem("zammo-bot-ui-kit-stay-open")},setConversationId:function(t){window.localStorage&&window.localStorage.setItem("zammo-bot-ui-kit-conversation-id",t)},getConversationId:function(){return window.localStorage?window.localStorage.getItem("zammo-bot-ui-kit-conversation-id"):null},setConversationToken:function(t){window.localStorage&&window.localStorage.setItem("zammo-bot-ui-kit-conversation-token",t)},getConversationToken:function(){return window.localStorage?window.localStorage.getItem("zammo-bot-ui-kit-conversation-token"):null},setHasStarted:function(t){window.localStorage&&window.localStorage.setItem("zammo-bot-ui-kit-has-started",t)},getHasStarted:function(){return!!window.localStorage&&"true"===window.localStorage.getItem("zammo-bot-ui-kit-has-started")},setUserId:function(t){window.localStorage&&window.localStorage.setItem("zammo-bot-ui-kit-user-id-dl",t)},getUserId:function(){return window.localStorage?window.localStorage.getItem("zammo-bot-ui-kit-user-id-dl"):null},setConversationTime:function(t){window.localStorage&&window.localStorage.setItem("zammo-bot-ui-kit-conversation-time",t)},getConversationTime:function(){return window.localStorage?window.localStorage.getItem("zammo-bot-ui-kit-conversation-time"):null},getCurrentTime:function(){return(new Date).getTime()},clearZammoItems:function(){window.localStorage.removeItem("zammo-bot-ui-kit-stay-open"),window.localStorage.removeItem("zammo-bot-ui-kit-conversation-id"),window.localStorage.removeItem("zammo-bot-ui-kit-conversation-token"),window.localStorage.removeItem("zammo-bot-ui-kit-has-started"),window.localStorage.removeItem("zammo-bot-ui-kit-user-id-dl"),window.localStorage.removeItem("zammo-bot-ui-kit-conversation-time")}}},getHTMLFromMarkdown:function(t){var e=ZammoBotUIKit.markdownit({html:!0,breaks:!0,linkify:!0}).render(t);return HtmlSanitizer.SanitizeHtml(e)},onDocumentReady:function(t){"loading"!==document.readyState?t():document.addEventListener?document.addEventListener("DOMContentLoaded",t):document.attachEvent("onreadystatechange",(function(){"loading"!==document.readyState&&t()}))}
/**
 * JavaScript HTML Sanitizer, (c) Alexander Yumashev, Jitbit Software.
 * @see https://github.com/jitbit/HtmlSanitizer
 * @license MIT https://github.com/jitbit/HtmlSanitizer/blob/master/LICENSE
 */},HtmlSanitizer=new function(){var t={A:!0,ABBR:!0,B:!0,BLOCKQUOTE:!0,BODY:!0,BR:!0,CENTER:!0,CODE:!0,DIV:!0,EM:!0,FONT:!0,H1:!0,H2:!0,H3:!0,H4:!0,H5:!0,H6:!0,HR:!0,I:!0,IMG:!0,LABEL:!0,LI:!0,OL:!0,P:!0,PRE:!0,SMALL:!0,SOURCE:!0,SPAN:!0,STRONG:!0,TABLE:!0,TBODY:!0,TR:!0,TD:!0,TH:!0,THEAD:!0,UL:!0,U:!0,VIDEO:!0},e={FORM:!0},o={align:!0,color:!0,controls:!0,height:!0,href:!0,src:!0,style:!0,target:!0,title:!0,type:!0,width:!0},n={color:!0,"background-color":!0,"font-size":!0,"text-align":!0,"text-decoration":!0,"font-weight":!0},i=["http:","https:","data:","m-files:","file:","ftp:","ftps:"],a={href:!0,action:!0};function r(t,e){for(var o=0;o<e.length;o++)if(0==t.indexOf(e[o]))return!0;return!1}this.SanitizeHtml=function(c){if(""===(c=c.trim()))return"";if("<br>"===c)return"";var m=document.createElement("iframe");if(void 0===m.sandbox)return alert("Your browser does not support sandboxed iframes. Please upgrade to a modern browser."),"";m.sandbox="allow-same-origin",m.style.display="none",document.body.appendChild(m);var l=m.contentDocument||m.contentWindow.document;null==l.body&&l.write("<body></body>"),l.body.innerHTML=c;var d=function c(m){if(m.nodeType==Node.TEXT_NODE)var d=m.cloneNode(!0);else if(m.nodeType==Node.ELEMENT_NODE&&(t[m.tagName]||e[m.tagName])){if(("SPAN"==m.tagName||"B"==m.tagName||"I"==m.tagName||"U"==m.tagName)&&""==m.innerHTML.trim())return document.createDocumentFragment();d=e[m.tagName]?l.createElement("DIV"):l.createElement(m.tagName);for(var u=0;u<m.attributes.length;u++){var h=m.attributes[u];if(o[h.name])if("style"==h.name)for(s=0;s<m.style.length;s++){var g=m.style[s];n[g]&&d.style.setProperty(g,m.style.getPropertyValue(g))}else{if(a[h.name]&&h.value.indexOf(":")>-1&&!r(h.value,i))continue;d.setAttribute(h.name,h.value)}}for(u=0;u<m.childNodes.length;u++){var p=c(m.childNodes[u]);d.appendChild(p,!1)}}else d=document.createDocumentFragment();return d}(l.body);return document.body.removeChild(m),d.innerHTML.replace(/<br[^>]*>(\S)/g,"<br>\n$1").replace(/div><div/g,"div>\n<div")},this.AllowedTags=t,this.AllowedAttributes=o,this.AllowedCssStyles=n,this.AllowedSchemas=i};ZammoBotUIKit.addViewportIfNotAvailable=function(){var t=document.querySelector('meta[name="viewport"]');if(!(t&&t.hasAttribute("content"))){var e=document.createElement("meta");e.id="zammo-ui-kit-viewport",e.name="viewport",e.content="width=device-width, initial-scale=1",document.getElementsByTagName("head")[0].appendChild(e)}},ZammoBotUIKit.Logger=function(t){this.environment=t,this.log=function(){"development"===this.environment&&console.log.apply(console,arguments)},this.error=function(){"development"===this.environment&&console.error.apply(console,arguments)}},ZammoBotUIKit.isNullOrEmpty=function(t){return null===t||""===t},ZammoBotUIKit.getAttributeOrDefault=function(t,e,o){var n=t.getAttribute(e);return ZammoBotUIKit.isNullOrEmpty(n)?o:n},ZammoBotUIKit.getCacheProtectedUrl=function(t){return t+(/\?/.test(t)?"&":"?")+(new Date).getTime()},ZammoBotUIKit.removeClass=function(t,e){for(var o=t.split(" "),n=[],i=0;i<o.length;i++)o[i]!==e&&n.push(o[i]);return n.join(" ")},ZammoBotUIKit.addClass=function(t,e){var o=t.split(" ");return o.push(e),o.join(" ")},ZammoBotUIKit.makeHTTPCall=function(t,e,o,n,i,a){o=void 0!==o?o:"GET",n=void 0!==n?n:null,i=void 0!==i?i:null;var s=new XMLHttpRequest;if(s.onload=function(t){var o=t.target;if(o.status>=400){var n="json"===o.responseType?o.response:JSON.parse(o.responseText);a?a(n):console.error("A fatal error occurred while making a network call. We show you the error to attempt to debug. Please contact your Zammo account manager.",n)}else"json"===o.responseType?e(o.response):e(JSON.parse(o.responseText))},s.onerror=function(t){var e=t.target;a&&a(t,e.status,e.statusText)},s.open(o,ZammoBotUIKit.getCacheProtectedUrl(t)),i)for(var r=Object.keys(i),c=0;c<r.length;c++){var m=r[c],l=i[m];s.setRequestHeader(m,l)}s.responseType="json",s.send(n)},ZammoBotUIKit.postForm=function(t,e,o,n,i){n=void 0!==n?n:null;var a=new XMLHttpRequest,s=new FormData;if(a.onload=function(){e&&e(a.response,a.status)},a.open("post",t),n)for(var r=Object.keys(n),c=0;c<r.length;c++){var m=r[c],l=n[m];a.setRequestHeader(m,l)}var d=(new Date).toISOString(),u=Array.from(o.files),h={type:"message",channelData:{attachmentSizes:u.map((function(t){return t.size})),pageUrl:window.location.href,clientTimestamp:d},from:i},g=new Blob([JSON.stringify(h)],{type:"application/vnd.microsoft.activity"});s.append("activity",g),u.forEach((function(t){s.append("files",t)})),a.send(s)},ZammoBotUIKit.uuidv4=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)}))},ZammoBotUIKit.checkExpiry=function(t){try{var e=ZammoBotUIKit.storage();if(parseInt(t)>0){var o=e.getCurrentTime(),n=e.getConversationTime(),i=!0===(n&&parseInt(n)+parseInt(t)<o);if(!n||i)return e.clearZammoItems(),e.setConversationTime(o),!0}return!1}catch(t){return!1}},ZammoBotUIKit.getUserId=function(t){try{var e=ZammoBotUIKit.storage();if(ZammoBotUIKit.checkExpiry(t),e.getUserId())return e.getUserId();var o="dl_"+ZammoBotUIKit.uuidv4();return e.setUserId(o),o}catch(t){return"dl_"+ZammoBotUIKit.uuidv4()}},ZammoBotUIKit.simpleUpdateIn=function(t,e,o){if(!e||0===e.length||!t||"object"!=typeof t)return t;var n=e[0];return t[n]||(t[n]={}),1==e.length?t[n]=o:t[n]=ZammoBotUIKit.simpleUpdateIn(t[n],e.slice(1),o),t},ZammoBotUIKit.formatDate=function(t){var e="0"+t.getHours(),o="0"+t.getMinutes();return e.slice(-2)+":"+o.slice(-2)},ZammoBotUIKit.isElementInViewport=function(t){"function"==typeof jQuery&&t instanceof jQuery&&(t=t[0]);var e=t.getBoundingClientRect();return e.top>=0&&e.left>=0&&e.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&e.right<=(window.innerWidth||document.documentElement.clientWidth)},ZammoBotUIKit.isset=function(t){return t&&void 0!==t},ZammoBotUIKit.openInNewTab=function(t){Object.assign(document.createElement("a"),{target:"_blank",href:t}).click()},ZammoBotUIKit.get=function(t,e,o){o=void 0!==o?o:void 0;var n=function(o){return String.prototype.split.call(e,o).filter(Boolean).reduce((function(t,e){return null!=t?t[e]:t}),t)},i=n(/[,[\]]+?/)||n(/[,[\].]+?/);return null==i||i===t?o:i},ZammoBotUIKit.AttachmentTypes={OAUTH:"application/vnd.microsoft.card.oauth",HERO:"application/vnd.microsoft.card.hero",THUMBNAIL:"application/vnd.microsoft.card.thumbnail",VIDEO:"application/vnd.microsoft.card.video",AUDIO:"application/vnd.microsoft.card.audio",PLAIN_VIDEO:"video/mp4",PLAIN_TEXT:"text/plain",PLAIN_AUDIO:"audio/mpeg",MARKDOWN_TEXT:"text/markdown",SIGN_IN:"application/vnd.microsoft.card.signin",ADAPTIVE_CARD:"application/vnd.microsoft.card.adaptive"},ZammoBotUIKit.ActionTypes={OPEN_URL:"Action.OpenUrl",SHOW_CARD:"Action.ShowCard",SUBMIT:"Action.Submit"},ZammoBotUIKit.isObject=function(t){var e=typeof t;return"function"===e||"object"===e&&!!t},ZammoBotUIKit.isNullOrUndefined=function(t){return null==t},ZammoBotUIKit.isWebSocketWorking=function(t,e){try{return new WebSocket(t),!0}catch(t){e&&e.error("ZammoBotUIKit.isWebSocketWorking","websocket error",t)}return!1},ZammoBotUIKit.isWebSocketSupported=function(t,e){return t=ZammoBotUIKit.isNullOrUndefined(t)?"wss://echo.websocket.org":t,!(!(WebSocket in window)&&ZammoBotUIKit.isNullOrUndefined(window.WebSocket)&&!ZammoBotUIKit.isWebSocketWorking(t,e))},ZammoBotUIKit.IsStrAValidJson=function(t){try{JSON.parse(t)}catch(t){return!1}return!0},ZammoBotUIKit.AttachmentService={chunkArrToMultiDimArr:function(t,e){for(var o=[];t.length>0;)o.push(t.slice(0,e)),t=t.slice(e);return o},getCardButtonsHTML:function(t){if(!t||0===t.length)return"";for(var e=[],o=t.length,n=ZammoBotUIKit.AttachmentService.chunkArrToMultiDimArr(t,1===o?1:o%2==0?2:3),i=0;i<n.length;i++)for(var a=0;a<n[i].length;a++){var s=n[i][a],r=ZammoBotUIKit.get(s,"value",""),c=ZammoBotUIKit.get(s,"text",""),m=ZammoBotUIKit.get(s,"title",""),l=m||s.text,d=ZammoBotUIKit.isObject(r)?'card-action-value="'+JSON.stringify(s.value).replace(/[\""]/g,"'")+'"':'card-action-value="'+s.value+'"',u='<button class="mdc-button mdc-card__action mdc-card__action--button '+(n[i].length,'zammo-button-single-per-row"card-action-type="')+s.type+'"'+d+'card-action-text="'+c.replace(/[\""]/g,"'")+'"card-action-display-text="'+s.displayText+'"><div class="mdc-button__ripple"></div><span class="mdc-button__label">'+l.replace(/[\""]/g,"'")+"</span></button>";e.push(u)}return heroCardButtonsHTML='<div class="mdc-card__actions"><div class="mdc-card__action-buttons">'+e.join("\n")+"</div></div>",heroCardButtonsHTML},getCardTextContentHTML:function(t,e,o){return(t?'<h2 class="zammo-card__title mdc-typography mdc-typography--headline6">'+t+"</h2>":"")+(e?'<h3 class="zammo-card__subhead mdc-typography mdc-typography--subtitle2">'+e+"</h3>":"")+(o?'<p class="zammo-card__supporting-text">'+o+"</p>":"")},getRichMediaCardAttachmentHTML:function(t){var e=ZammoBotUIKit.get(t,"content.image.url",""),o=e?'<div class="mdc-card__media mdc-card__media--square zammo-card__media-thumbnail" style="background-image: url(&quot;'+e+'&quot;);"><div class="mdc-card__media-content"></div></div>':"",n=ZammoBotUIKit.get(t,"contentType")===ZammoBotUIKit.AttachmentTypes.VIDEO?"video":"audio",i=ZammoBotUIKit.get(t,"content.title"),a=ZammoBotUIKit.get(t,"content.subtitle"),s=ZammoBotUIKit.get(t,"content.text");return'<div class="mdc-card" style="width:fit-content;"><div class="mdc-card__primary-action zammo-card__primary-action'+(i||a||s||e?"":"zammo-no-header")+'" tabindex="0">'+o+'<div class="zammo-card__primary '+(i||a||s?"":"zammo-no-title")+'">'+ZammoBotUIKit.AttachmentService.getCardTextContentHTML(i,a,s)+'</div></div><div class="mdc-card__primary-action mdc-ripple-upgraded"><'+n+' class="zammo-card__media-rich" controls poster="'+e+'"><source src="'+ZammoBotUIKit.get(t,"content.media.0.url")+"\">Sorry, your browser doesn't support embedded videos.</"+n+"></div>"+ZammoBotUIKit.AttachmentService.getCardButtonsHTML(ZammoBotUIKit.get(t,"content.buttons"))+"</div>"},getVideoAttachment:function(t){var e,o,n,i=ZammoBotUIKit.get(t,"name"),a=i?'<h2 class="zammo-card__title mdc-typography mdc-typography--headline6">'+i+"</h2>":"";return'<div class="mdc-card" style="width:fit-content;"><div class="mdc-card__primary-action mdc-ripple-upgraded"><iframe src="'+(e=ZammoBotUIKit.get(t,"contentUrl"),n=e,(o=e.match(/^.*(vimeo\.com\/)((channels\/[A-z]+\/)|(groups\/[A-z]+\/videos\/))?([0-9]+)/))?n="https://player.vimeo.com/video/"+o[5]+"?autoplay=0&badge=0&byline=0&loop=0&portrait=0&title=0":(o=e.match(/^.*(youtu\.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/))&&11===o[2].length&&(n="https://www.youtube.com/embed/"+o[2]+"?autoplay=0&loop=0&modestbranding=1"),n+'" style="width:100%" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe></div><div class="zammo-card__primary">')+a+"</div></div>"},getAudioAttachment:function(t){var e=ZammoBotUIKit.get(t,"name"),o=e?'<h2 class="zammo-card__title mdc-typography mdc-typography--headline6">'+e+"</h2>":"";return'<div class="mdc-card" style="width:fit-content;"><div class="mdc-card__primary-action mdc-ripple-upgraded"><audio class="zammo-card__media-rich" controls><source src="'+ZammoBotUIKit.get(t,"contentUrl")+'">Sorry, your browser doesn\'t support embedded videos.</audio></div><div class="zammo-card__primary">'+o+"</div></div>"},getHeroCardAttachmentHTML:function(t){var e=ZammoBotUIKit.get(t,"content.images.0.url");return'<div class="mdc-card" style="width:fit-content;">'+(e?'<div class="mdc-card__media mdc-card__media--square" style="background-size: contain;background-image: url(&quot;'+e+'&quot;);"><div class="mdc-card__media-content"></div></div>':"")+'<div class="mdc-card-wrapper__text-section">'+ZammoBotUIKit.AttachmentService.getCardTextContentHTML(ZammoBotUIKit.get(t,"content.title"),ZammoBotUIKit.get(t,"content.subtitle"),ZammoBotUIKit.get(t,"content.text"))+"</div>"+ZammoBotUIKit.AttachmentService.getCardButtonsHTML(ZammoBotUIKit.get(t,"content.buttons"))+"</div>"},getThumbnailCardAttachmentHTML:function(t){var e=ZammoBotUIKit.get(t,"content.images.0.url");return'<div class="mdc-card" style="width:fit-content;"><div class="mdc-card__primary-action zammo-card__primary-action" tabindex="0">'+(e?'<div class="mdc-card__media mdc-card__media--square zammo-card__media" style="background-image: url(&quot;'+e+'&quot;);"></div>':"")+'<div class="zammo-card__primary">'+ZammoBotUIKit.AttachmentService.getCardTextContentHTML(ZammoBotUIKit.get(t,"content.title"),ZammoBotUIKit.get(t,"content.subtitle"),ZammoBotUIKit.get(t,"content.text"))+"</div></div>"+ZammoBotUIKit.AttachmentService.getCardButtonsHTML(ZammoBotUIKit.get(t,"content.buttons"))+"</div>"},getAdaptiveCardAttachment:function(t,e){var o=ZammoBotUIKit.get(t,"content"),n=new AdaptiveCards.AdaptiveCard;n.hostConfig=new AdaptiveCards.HostConfig(ZammoBotUIKit.defaultAdapativeCardHostConfig),n.onExecuteAction=function(t){var o=ZammoBotUIKit.get(t,"_propertyBag.type"),n=ZammoBotUIKit.get(t,"_processedData");switch(o){case ZammoBotUIKit.ActionTypes.OPEN_URL:return void ZammoBotUIKit.openInNewTab(ZammoBotUIKit.get(t,"url"));case ZammoBotUIKit.ActionTypes.SUBMIT:var i=(new Date).toISOString(),a={channelData:{pageUrl:window.location.href,clientTimestamp:i,postBack:!0},text:"string"==typeof n?n:void 0,value:"string"!=typeof n?n:void 0,type:"message",channelId:"webchat",from:e.user,timestamp:i,entities:[{requiresBotState:!0,supportsListening:!0,supportsTts:!0,type:"ClientCapabilities"}]};return void e.sendActivity(a);default:return}},n.parse(o);var i=n.render();if(i&&e&&e.chatArea){i.className=ZammoBotUIKit.addClass(i.className,"mdc-card");var a=document.createElement("div");a.innerHTML='<div class="msg left-msg"><div class="msg-bubble" style="padding-bottom: 5%"></div></div>';var s=a.querySelector(".msg-bubble");s.appendChild(i),e.chatArea.appendChild(s)}return""},getAttachmentHTML:function(t,e){if(!t)return"";switch(t.contentType){case ZammoBotUIKit.AttachmentTypes.HERO:return ZammoBotUIKit.AttachmentService.getHeroCardAttachmentHTML(t);case ZammoBotUIKit.AttachmentTypes.THUMBNAIL:return ZammoBotUIKit.AttachmentService.getThumbnailCardAttachmentHTML(t);case ZammoBotUIKit.AttachmentTypes.PLAIN_TEXT:return ZammoBotUIKit.get(t,"content","");case ZammoBotUIKit.AttachmentTypes.MARKDOWN_TEXT:return ZammoBotUIKit.getHTMLFromMarkdown(ZammoBotUIKit.get(t,"content",""));case ZammoBotUIKit.AttachmentTypes.AUDIO:case ZammoBotUIKit.AttachmentTypes.VIDEO:return ZammoBotUIKit.AttachmentService.getRichMediaCardAttachmentHTML(t);case ZammoBotUIKit.AttachmentTypes.PLAIN_AUDIO:return ZammoBotUIKit.AttachmentService.getAudioAttachment(t);case ZammoBotUIKit.AttachmentTypes.PLAIN_VIDEO:return ZammoBotUIKit.AttachmentService.getVideoAttachment(t);case ZammoBotUIKit.AttachmentTypes.SIGN_IN:case ZammoBotUIKit.AttachmentTypes.OAUTH:return ZammoBotUIKit.AttachmentService.getHeroCardAttachmentHTML(t);case ZammoBotUIKit.AttachmentTypes.ADAPTIVE_CARD:return ZammoBotUIKit.AttachmentService.getAdaptiveCardAttachment(t,e);default:return""}},getAttachmentsHTML:function(t,e){if(!t)return"";for(var o=[],n=0;n<t.length;n++)o.push(ZammoBotUIKit.AttachmentService.getAttachmentHTML(t[n],e));return'<div class="zammo-message-attachments">'+o.join('\n<div class="zammo-message-attachments-sep"></div>\n')+"</div>"}},ZammoBotUIKit.CardActionTypes={OPEN_URL:"openUrl",IM_BACK:"imBack",MESSAGE_BACK:"messageBack",SIGN_IN:"signin"},ZammoBotUIKit.loadScript=function(t,e){if("undefined"==typeof require||"function"!=typeof require){var o=document.getElementsByTagName("head")[0],n=document.createElement("script");n.src=t;var i=!1;n.onload=n.onreadystatechange=function(){i||this.readyState&&"loaded"!=this.readyState&&"complete"!=this.readyState||(i=!0,"function"==typeof e&&e(),n.onload=n.onreadystatechange=null,o.removeChild(n))},o.appendChild(n)}else require([t],(function(t){e(t)}))},ZammoBotUIKit.loadStyle=function(t,e,o,n){if(n=void 0!==n&&n,!document.getElementById(e)){var i=document.getElementsByTagName("head")[0],a=document.createElement("link");a.id=e,a.rel="stylesheet",a.type="text/css",a.href=t,a.media="all";var s=!1;n&&(a.rel="stylesheet preload",a.as="style"),a.onload=a.onreadystatechange=function(){s||this.readyState&&"loaded"!=this.readyState&&"complete"!=this.readyState||(s=!0,a.rel="stylesheet","function"==typeof o&&o(),a.onload=a.onreadystatechange=null)},i.appendChild(a)}},ZammoBotUIKit.ZammoBotUI=function(t){this.environment=t.environment,this.cssUrl=t.cssUrl,this.logger=new ZammoBotUIKit.Logger(t.environment),this.webChatId=t.webChatId,this.zammoApiBaseUrl=t.zammoApiBaseUrl,this.stickyChat="true"===t.stickyChat,this.shouldHideBranding=t.shouldHideBranding,this.ttlInMilliseconds=t.ttlInMilliseconds,this.directLineUrl=t.directLineUrl,this.shouldLoadDependencies=t.shouldLoadDependencies,this.shouldShowMicrophone=t.shouldShowMicrophone,this.shouldShowExtensionMenu=t.shouldShowExtensionMenu,this.simulatorToken=t.simulatorToken,this.lastMessageLocale="en-US",this.messages={},this.user={id:ZammoBotUIKit.getUserId(t.ttlInMilliseconds),role:"user"},this.hasReceivedAMessage=!1,this.pollingAttemptsCount=0,this.announceHook=function(t){for(var e of ZammoBotUIKit.Extensions)if(e&&e.canHandleHook&&e.canHandleHook(t)&&e.handleHook&&(e.handleHook(t,this),!e.shouldContinueAfterHandlingHook||!e.shouldContinueAfterHandlingHook(t)))return!1;return!0},this.loadRequiredStylesAndScripts=function(t){var e=this;"false"!==this.shouldLoadDependencies?(ZammoBotUIKit.loadScript("https://cdnjs.cloudflare.com/ajax/libs/markdown-it/12.2.0/markdown-it.min.js",(function(o){ZammoBotUIKit.isset(o)?(e.logger.log("ZammoBotUIKit.ZammoBotUI.run::","Markdown-it was loaded with RequireJS"),ZammoBotUIKit.markdownit=o):(e.logger.log("ZammoBotUIKit.ZammoBotUI.run::","loaded without RequireJS",window.markdownit),ZammoBotUIKit.markdownit=window.markdownit),e.logger.log("ZammoBotUIKit.ZammoBotUI.run::","finished loading Markdown-it library"),ZammoBotUIKit.loadScript("https://unpkg.com/adaptivecards@2.10.0/dist/adaptivecards.min.js",(function(){e.logger.log("ZammoBotUIKit.ZammoBotUI.run::","finished loading the adaptive dialog library"),ZammoBotUIKit.loadScript("https://cdn.jsdelivr.net/npm/microsoft-cognitiveservices-speech-sdk@latest/distrib/browser/microsoft.cognitiveservices.speech.sdk.bundle-min.js",(function(){e.logger.log("ZammoBotUIKit.ZammoBotUI.run::","finished loading the speech SDK library"),t()}))}))})),ZammoBotUIKit.loadStyle(ZammoBotUIKit.getCacheProtectedUrl(e.cssUrl),"zammoBotUIKitStyle",(function(){e.logger.log("ZammoBotUIKit.ZammoBotUI.run::","finished loading zammo bot ui kit style")}),!0),ZammoBotUIKit.loadStyle("https://unpkg.com/material-components-web@7.0.0/dist/material-components-web.min.css","zammoBotUIMaterialIO",(function(){e.logger.log("ZammoBotUIKit.ZammoBotUI.run::","finished loading material.io styles.")})),ZammoBotUIKit.loadStyle("https://fonts.googleapis.com/css?family=Montserrat","zammoBotUIStyleFont",(function(){e.logger.log("ZammoBotUIKit.ZammoBotUI.run::","finished loading Montserrat font.")})),ZammoBotUIKit.loadStyle("https://fonts.googleapis.com/icon?family=Material+Icons","zammoBotUIKitStyleFontEmoji",(function(){e.logger.log("ZammoBotUIKit.ZammoBotUI.run::","finished loading Material Icon")}))):t()},this.getBotUIComponent=function(){var t=document.createElement("div");t.id=ZammoBotUIKit.constants.ZAMMO_BOT_UI_ID;var e=this.shouldHideBranding?"":'<div id="zammoBotUIComponent--chatFrame--footer">powered with <i class="material-icons">favorite</i> by <a href="https://zammo.ai" id="zammo-url">zammo.ai</a></div>',o=window.SpeechSDK&&this.shouldShowMicrophone?'<button id="zammoBotUIComponent--chatFrame--microphone"><i class="material-icons">mic</i></button>':"",n=this.shouldShowExtensionMenu?'<div id="zammoBotUIComponent--chatFrame--header--extension-menu">\x3c!-- three dots --\x3e<ul id="zammoBotUIComponent--chatFrame--header--extension-menu--icons" tabindex="0" aria-label="additional options for the chabot button"><li></li><li></li><li></li></ul>\x3c!-- menu --\x3e<div id="zammoBotUIComponent--chatFrame--header--extension-menu--options"><button id="zammoBotUIComponent--chatFrame--header--extension-menu--options--refresh-session-button">Refresh session</button></div></div>':"";return t.innerHTML='<button id="zammoBotUIComponent--chatIcon" aria-label="open chat bot"><i class="material-icons" id="zammoBotUIComponent--chatIcon--icon">question_answer</i></button><div id="zammoBotUIComponent--chatFrame"><div id="zammoBotUIComponent--chatFrame--header">'+n+'<button id="zammoBotUIComponent--chatFrame--header--closeIcon"><i class="material-icons mode-close">close</i></button></div><div id="zammoBotUIComponent--chatFrame--chat"><section class="msger"><main class="msger-chat" tabindex="0" aria-label="Chatbot conversation"></main><form class="msger-inputarea">'+o+'<input aria-label="Message to ask the bot input box" type="text" class="msger-input" placeholder="Enter your message..."><button type="submit" class="msger-send-btn"><i class="material-icons">send</i></button></form></section></div><div id="zammoBotUIComponent--chatEventBar"><span></span></div>'+e+"</div>",t},this.processUserInput=function(t,e,o){if(t){t=ZammoBotUIKit.sanitizeHTML(t),e=void 0!==e?e:null,o=void 0!==o?o:null;var n=(new Date).toISOString();this.removeSuggestedActions(),this.chatInput.value="";var i={channelData:{pageUrl:window.location.href,clientTimestamp:n},text:t,textFormat:"plain",type:"message",channelId:"webchat",from:this.user,timestamp:n,entities:[{requiresBotState:!0,supportsListening:!0,supportsTts:!0,type:"ClientCapabilities"}]};o&&(i.value=o),e&&(i.channelData.messageBack={displayText:e}),this.sendActivity(i)}},this.showErrorMessage=function(t,e){var o=this;e=void 0!==e?e:1e4;o.setEventBarMessage(t);var n=document.querySelector("#zammoBotUIComponent--chatEventBar");n.className=ZammoBotUIKit.addClass(n.className,"has-error"),o.displayEventBar(),e>0&&setTimeout((function(){o.hideEventBar(),n.className=ZammoBotUIKit.removeClass(n.className,"has-error"),o.setEventBarMessage("")}),e)},this.IsValidSpeechToken=function(t){return t&&t.tokenExpiration>(new Date).getTime()},this.processSpeechTokenInfo=function(t,e,o){var n=this;t?(n.speechTokenInfo={token:t,region:e,tokenExpiration:(new Date).getTime()+ZammoBotUIKit.constants.SPEECH_TOKEN_EXPIRATION_TIME_IN_MS},setTimeout((function(){n.getSpeechTokenInfo((function(){}))}),ZammoBotUIKit.constants.SPEECH_TOKEN_EXPIRATION_TIME_IN_MS),o({isSuccess:!0,token:t,region:e})):o({isSuccess:!1,reason:"could not retrieve a new valid authentication token"})},this.getSpeechTokenInfo=function(t){var e=this;e.speechTokenInfo&&e.IsValidSpeechToken(e.speechTokenInfo)?t({isSuccess:!0,token:e.speechTokenInfo.token,region:e.speechTokenInfo.region}):e.simulatorToken?ZammoBotUIKit.makeHTTPCall(e.zammoApiBaseUrl+"/api/simulator/webchat/speech/session?simulatorToken="+e.simulatorToken,(function(o){e.processSpeechTokenInfo(o.speechToken,o.speechRegion,t)})):ZammoBotUIKit.makeHTTPCall(e.zammoApiBaseUrl+"/api/webchat/speech-token/"+e.webChatId,(function(o){e.processSpeechTokenInfo(o.authorizationToken,o.region,t)}))},this.startSpeechRecognition=function(t,e,o){var n=this,i=window.SpeechSDK.SpeechConfig.fromAuthorizationToken(t,e);i.speechRecognitionLanguage=n.lastMessageLocale;var a=window.SpeechSDK.AudioConfig.fromDefaultMicrophoneInput();n.recognizer=new window.SpeechSDK.SpeechRecognizer(i,a),n.recognizer.recognizeOnceAsync((function(t){switch(n.recognizer.close(),t.reason){case window.SpeechSDK.ResultReason.RecognizedSpeech:o({isSuccess:!0,result:t.text});break;case window.SpeechSDK.ResultReason.NoMatch:o({isSuccess:!1,reason:"Speech could not be recognized."});break;case window.SpeechSDK.ResultReason.Canceled:const e=SpeechSDK.CancellationDetails.fromResult(t);n.logger.log("CANCELED: Reason="+e.reason),o({isSuccess:!1,reason:"CANCELED: Reason="+e.reason}),e.reason==window.SpeechSDK.CancellationReason.Error&&(n.logger.log("CANCELED: ErrorCode="+e.ErrorCode),n.logger.log("CANCELED: ErrorDetails="+e.errorDetails),n.logger.log("CANCELED: Did you set the speech resource key and region values?"));break;default:o({isSuccess:!1,reason:"UNKNOWN: Unknown error."})}}),(function(t){n.logger.log("recognizeOnceAsync","err",t),n.recognizer.close(),o({isSuccess:!1,reason:t})}))},this.toggleContextualMenuOptions=function(){this.chatExtensionMenuOptions&&("block"===window.getComputedStyle(this.chatExtensionMenuOptions).display?this.chatExtensionMenuOptions.style.display="none":this.chatExtensionMenuOptions.style.display="block")},this.addExtensionMenuOption=function(t,e,o,n){if(this.chatExtensionMenuOptions){var i=n?'aria-label="'+n+'"':"",a='<button id="'+(o=o||"zammoBotUIComponent--chatFrame--header--extension-menu--options--"+ZammoBotUIKit.uuidv4())+'" '+i+">"+t+"</button>";this.chatExtensionMenuOptions.insertAdjacentHTML("beforeend",a);var s=this,r=document.querySelector("#"+o);return r&&r.addEventListener("click",(function(t){t.preventDefault(),e(o),s.toggleContextualMenuOptions()})),o}},this.setProperties=function(){this.chatFrame=document.getElementById("zammoBotUIComponent--chatFrame"),this.chatIcon=document.getElementById("zammoBotUIComponent--chatIcon"),this.chatIconIcon=document.getElementById("zammoBotUIComponent--chatIcon--icon"),this.chatWindow=document.getElementById("zammoBotUIComponent--chatFrame--chat"),this.chatWindowHeader=document.getElementById("zammoBotUIComponent--chatFrame--header"),this.chatWindowClosingIcon=document.getElementById("zammoBotUIComponent--chatFrame--header--closeIcon"),this.chatInput=document.querySelector(".msger-input"),this.chatArea=document.querySelector(".msger-chat"),this.chatInputForm=document.querySelector(".msger-inputarea"),this.chatInputSendButton=document.querySelector(".msger-send-btn"),this.chatInputMicrophoneButton=document.querySelector("#zammoBotUIComponent--chatFrame--microphone"),this.chatExtensionMenuButton=document.querySelector("#zammoBotUIComponent--chatFrame--header--extension-menu--icons"),this.chatExtensionMenuOptions=document.querySelector("#zammoBotUIComponent--chatFrame--header--extension-menu--options"),this.chatExtensionMenuOptionRefreshSession=document.querySelector("#zammoBotUIComponent--chatFrame--header--extension-menu--options--refresh-session-button");var t=this;this.chatInput.addEventListener("keydown",(function(e){13==e.keyCode&&(e.preventDefault(),t.processUserInput(t.chatInput.value))})),this.chatInputSendButton.addEventListener("click",(function(e){e.preventDefault(),t.processUserInput(t.chatInput.value)})),this.chatInputMicrophoneButton&&this.chatInputMicrophoneButton.addEventListener("click",(function(e){e.preventDefault(),t.isProcessingMicrophoneInput?t.recognizer&&(t.recognizer.close(),t.chatInputMicrophoneButton.className=ZammoBotUIKit.removeClass(t.chatInputMicrophoneButton.className,"speech-processing"),t.isProcessingMicrophoneInput=!1):t.getSpeechTokenInfo((function(e){e.isSuccess?(t.isProcessingMicrophoneInput=!0,t.chatInputMicrophoneButton.className=ZammoBotUIKit.addClass(t.chatInputMicrophoneButton.className,"speech-processing"),t.startSpeechRecognition(e.token,e.region,(function(e){t.isProcessingMicrophoneInput=!1,t.chatInputMicrophoneButton.className=ZammoBotUIKit.removeClass(t.chatInputMicrophoneButton.className,"speech-processing"),e.isSuccess?t.processUserInput(e.result):t.showErrorMessage(e.reason)}))):t.showErrorMessage(recognitionResult.reason)}))})),this.chatExtensionMenuButton&&(this.chatExtensionMenuButton.addEventListener("click",(function(e){e.preventDefault(),t.toggleContextualMenuOptions()})),this.chatExtensionMenuButton.addEventListener("keydown",(function(e){13==e.keyCode&&(e.preventDefault(),t.toggleContextualMenuOptions())}))),this.chatExtensionMenuOptionRefreshSession&&this.chatExtensionMenuOptionRefreshSession.addEventListener("click",(function(e){e.preventDefault(),t.clearChatHistory(),t.resetSession(),t.toggleContextualMenuOptions()}))},this.closeChat=function(){this.announceHook(ZammoBotUIKit.ChatWidgetHooks.START_CLOSING_CHATBOT)&&(this.chatFrame.className=ZammoBotUIKit.removeClass(this.chatFrame.className,"is-visible"),this.chatIcon.className=ZammoBotUIKit.removeClass(this.chatIcon.className,"is-hidden"),ZammoBotUIKit.storage().setStayOpen(!1),this.announceHook(ZammoBotUIKit.ChatWidgetHooks.END_CLOSING_CHATBOT))},this.getSimulatorSessionInfo=function(t){var e=this;ZammoBotUIKit.makeHTTPCall(e.zammoApiBaseUrl+"/api/simulator/webchat/session?simulatorToken="+e.simulatorToken+"&userId="+e.user.id,(function(e){t({isSuccess:!0,simulatorSessionInfo:e})}),"GET",{},{Accept:"application/json"},(function(o){e.logger.log("getSimulatorSessionInfo","makeHTTPCallErr",o),t({isSuccess:!1,error:o})}))},this.openChat=function(){var t=ZammoBotUIKit.storage();if(t.setStayOpen(!0),this.announceHook(ZammoBotUIKit.ChatWidgetHooks.START_OPENING_CHATBOT)){var e=this;if(e.isFirstOpening){e.appendTyping();var o=t.getConversationId(),n=t.getConversationToken();o&&"undefined"!==o&&n&&"undefined"!=n?(e.conversation={token:n,id:o},e.checkConnection((function(){e.isFirstOpening=!1}),!0)):e.simulatorToken?e.connectNew((function(){e.isFirstOpening=!1}),!0):ZammoBotUIKit.makeHTTPCall(e.zammoApiBaseUrl+"/api/webchat/token/"+e.webChatId+"/"+e.user.id,(function(t){e.logger.log("ZammoBotUIKit.ZammoBotUI.run::","the api response is",t);var o=t.conversationId;e.conversation={token:t.token,id:o},e.checkConnection((function(){e.isFirstOpening=!1}),!0)}))}this.chatFrame.className=ZammoBotUIKit.addClass(this.chatFrame.className,"is-visible"),this.chatIcon.className=ZammoBotUIKit.addClass(this.chatIcon.className,"is-hidden"),this.chatInput&&this.chatInput.focus(),this.announceHook(ZammoBotUIKit.ChatWidgetHooks.END_OPENING_CHATBOT)}},this.isChatOpen=function(){return-1!==this.chatFrame.className.indexOf("is-visible")},this.setCommands=function(){var t=this;this.chatIcon.onclick=function(e){e.preventDefault(),t.isChatOpen()?t.closeChat():t.openChat()},this.chatWindowClosingIcon.onclick=function(e){e.preventDefault(),t.closeChat()}},this.appendTyping=function(){this.chatArea.insertAdjacentHTML("beforeend",'<div class="msg-typing"></div>'),this.chatArea.scrollTop+=500},this.removeTyping=function(){var t=document.querySelectorAll(".msg-typing");if(t)for(var e=0;e<t.length;e++)t[e].remove()},this.removeSuggestedActions=function(){var t=document.querySelectorAll(".msg-suggested-actions-carousel-container");if(t)for(var e=0;e<t.length;e++)t[e].remove()},this.bindSuggestedActions=function(t){if(t&&0!==t.length)for(var e=this,o=document.querySelectorAll(".msg-button-div"),n=0;n<o.length;n++)o[n].onclick=function(){var t=this.getAttribute("action-type"),o=this.getAttribute("action-value"),n=this.getAttribute("action-display-text"),i=this.getAttribute("action-text");t===ZammoBotUIKit.CardActionTypes.MESSAGE_BACK?e.processUserInput(i,n,o):e.processUserInput(o)}},this.getSuggestedActionsHTML=function(t){if(!t||0===t.length)return"";for(var e=['<div class="msg-suggested-actions">'],o=0;o<t.length;o++){var n=t[o].title?t[o].title:t[o].text?t[o].text:t[o].value;e.push('<div class="msg-button-div" action-text="'+t[o].text+'" action-type="'+t[o].type+'" action-display-text="'+t[o].displayText+'" action-value="'+t[o].value+'">'+n+"</div>")}return e.push("</div>"),'<div class="msg-suggested-actions-carousel-container" style="width:80%; margin-top: 3%;"><div class="msg-suggested-actions-chips-container" style="position: relative;">'+e.join("\n")+"</div></div>"},this.bindCardActions=function(){var t=this,e=document.querySelectorAll(".mdc-button");if(e)for(var o=0;o<e.length;o++)e[o].onclick=function(){var e=this.getAttribute("card-action-type"),o=this.getAttribute("card-action-text"),n=this.getAttribute("card-action-display-text"),i=this.getAttribute("card-action-value");switch(e){case ZammoBotUIKit.CardActionTypes.SIGN_IN:case ZammoBotUIKit.CardActionTypes.OPEN_URL:return ZammoBotUIKit.openInNewTab(i);case ZammoBotUIKit.CardActionTypes.IM_BACK:return t.processUserInput(i);case ZammoBotUIKit.CardActionTypes.MESSAGE_BACK:return t.processUserInput(o,n,i)}}},this.appendEvent=function(t){var e="the bot said at "+ZammoBotUIKit.formatDate(new Date);this.removeSuggestedActions();var o='<section class="event"><span class="sr-only">'+e+"</span>"+t+"</section>";this.chatArea.insertAdjacentHTML("beforeend",o),this.chatArea.scrollTop=this.chatArea.scrollHeight},this.appendMessage=function(t,e,o,n,i){if(n=void 0!==n?n:null,i=void 0!==i?i:null,e||n||i){this.removeSuggestedActions();var a=this.getSuggestedActionsHTML(n),s=ZammoBotUIKit.AttachmentService.getAttachmentsHTML(i,this),r='<div tabindex="0" aria-live="polite" class="msg '+t+'-msg"><div class="msg-bubble"><section class="msg-text"><span class="sr-only">'+(("left"===t?"the bot":"you")+" said at "+ZammoBotUIKit.formatDate(new Date(o)))+"</span>"+(ZammoBotUIKit.isset(e)?e:"")+"</section>"+s+'<div aria-hidden="true" class="msg-info"><div class="msg-info-time">'+ZammoBotUIKit.formatDate(new Date(o))+"</div></div></div>"+a+"</div>";this.chatArea.insertAdjacentHTML("beforeend",r),this.chatArea.scrollTop=this.chatArea.scrollHeight,this.bindSuggestedActions(n),this.bindCardActions()}},this.createFileUploadArea=function(){var t=this,e=(new Date).getTime(),o="drop"+e,n="file"+e,i="choose"+e,a="button"+e,s="fileInfo"+e,r="uploading"+e,c="error"+e,m='<div id="'+o+'" class="drop-area"><p>Drag and drop onto the dashed region or use the Choose files button</p><input type="file" id="'+n+'" multiple accept="image/*" hidden /><label id="'+i+'" class="mdc-button choose-button" for="'+n+'"><div class="mdc-button__ripple"></div><span class="">Choose files</span></label><p id="'+s+'"></p><p id="'+c+'" class="error hide"></p><button id="'+a+'" class="mdc-button send-button hide"><div class="mdc-button__ripple"></div><span class="">Send</span></button><p id="'+r+'" class="loading hide">Uploading...</p></div>';this.chatArea.insertAdjacentHTML("beforeend",m);var l=document.querySelectorAll("#"+o)[0],d=document.querySelectorAll("#"+a)[0],u=document.querySelectorAll("#"+i)[0],h=document.querySelectorAll("#"+n)[0],g=document.querySelectorAll("#"+s)[0],p=document.querySelectorAll("#"+r)[0],v=document.querySelectorAll("#"+c)[0];function I(){for(var t="<ul>",e=0;e<h.files.length;e++)t+="<li>"+h.files[e].name+"</li>";t+="</ul>",g.innerHTML=t,h.files.length>0?d.classList.remove("hide"):U()}function f(t){t.preventDefault(),t.stopPropagation()}function B(){p.classList.add("hide")}function U(){d.classList.add("hide")}function y(t){l.classList.add("highlight")}function b(t){l.classList.remove("highlight")}h.addEventListener("change",(function(t){I()})),["dragenter","dragover","dragleave","drop"].forEach((function(t){l.addEventListener(t,f,!1)})),["dragenter","dragover"].forEach((function(t){l.addEventListener(t,y,!1)})),["dragleave","drop"].forEach((function(t){l.addEventListener(t,b,!1)})),l.addEventListener("drop",(function(t){var e=t.dataTransfer;h.files=e.files,I()}),!1),d.addEventListener("click",(function(e){return v.innerHTML="",v.classList.add("hide"),U(),u.classList.add("hide"),p.classList.remove("hide"),e.preventDefault(),t.checkConnection((function(){ZammoBotUIKit.postForm(t.zammoApiBaseUrl+"/api/attachment-upload/"+t.webChatId+"?conversationId="+t.conversation.conversationId+"&userId="+t.user.id,(function(e,o){if(400===o)a=e,v.innerHTML=a,v.classList.remove("hide"),u.classList.remove("hide"),B();else{var n=(new Date).toISOString(),i={channelData:{pageUrl:window.location.href,clientTimestamp:n,postBack:!0},name:"zammoExtendedFileSizeUpload",type:"message",text:"File(s) uploaded",channelId:"webchat",from:t.user,timestamp:n,entities:[JSON.parse(e)]};B(),t.sendActivity(i),["dragenter","dragover"].forEach((function(t){l.removeEventListener(t,y,!1)})),["dragleave","drop"].forEach((function(t){l.removeEventListener(t,b,!1)})),["dragenter","dragover","dragleave","drop"].forEach((function(t){l.removeEventListener(t,f,!1)}))}var a}),h,{Authorization:"Bearer "+t.conversation.token},t.user)}),!1),!1})),this.chatArea.scrollTop=this.chatArea.scrollHeight},this.setEventBarMessage=function(t){document.querySelector("#zammoBotUIComponent--chatEventBar span").innerHTML=t},this.displayEventBar=function(){var t=document.querySelector("#zammoBotUIComponent--chatEventBar");this.chatWindow.className=ZammoBotUIKit.removeClass(this.chatWindow.className,"is-event-bar-visible"),t.className=ZammoBotUIKit.removeClass(t.className,"is-event-bar-visible"),this.chatWindow.className=ZammoBotUIKit.addClass(this.chatWindow.className,"is-event-bar-visible"),t.className=ZammoBotUIKit.addClass(t.className,"is-event-bar-visible")},this.hideEventBar=function(){var t=document.querySelector("#zammoBotUIComponent--chatEventBar");this.chatWindow.className=ZammoBotUIKit.removeClass(this.chatWindow.className,"is-event-bar-visible"),t.className=ZammoBotUIKit.removeClass(t.className,"is-event-bar-visible"),this.setEventBarMessage("")},this.handleLocationRequest=function(){var t=this;if(this.displayEventBar(),this.setEventBarMessage("Retrieving location information ..."),navigator&&navigator.geolocation)navigator.geolocation.getCurrentPosition((function(e){t.setEventBarMessage("Sending location back to the bot ...");var o={IsSuccess:!0,Latitude:e.coords.latitude,Longitude:e.coords.longitude,Reason:""},n={text:JSON.stringify(o),type:ZammoBotUIKit.constants.customActivityType.ZammoSubmitLocation,channelId:"directline",from:t.user};t.sendActivity(n)}),(function(){t.setEventBarMessage("Sending location back to the bot ...");var e={text:JSON.stringify({IsSuccess:!1,Reason:"user denied to share their location"}),type:ZammoBotUIKit.constants.customActivityType.ZammoSubmitLocation,channelId:"directline",from:t.user};t.sendActivity(e)}));else{t.setEventBarMessage("Sending location back to the bot ...");var e={text:JSON.stringify({IsSuccess:!1,Reason:"the location isn't available on the user's browser"}),type:ZammoBotUIKit.constants.customActivityType.ZammoSubmitLocation,channelId:"directline",from:t.user};t.sendActivity(e)}},this.processWebsocketMessage=function(t){try{var e=JSON.parse(t);if(e.activities&&e.activities.length>0){var o=e.activities[e.activities.length-1];if(this.messages[o.id])return void this.logger.log("ZammoBotUIKit.ZammoBotUI.processWebsocketMessage","discarding already processed",this.messages,t);this.messages[o.id]=42,this.logger.log("ZammoBotUIKit.ZammoBotUI.processWebsocketMessage","activity",o),this.lastMessageLocale=o.locale?o.locale:this.lastMessageLocale;for(var n=0;n<ZammoBotUIKit.Extensions.length;n++){var i=ZammoBotUIKit.Extensions[n];if(i.canHandleInbound(o,this))return void i.handleInbound(o,this,this.logger)}if(this.simulatorToken&&o.channelData&&o.channelData.UiBuilderIgnore)return;if("message"===o.type&&o.from&&o.from.id!==this.user.id){this.logger.log("activity.timestamp",o.timestamp),this.removeTyping(),this.hideEventBar(),this.hasReceivedAMessage=!0;var a=ZammoBotUIKit.isset(o.text)?ZammoBotUIKit.getHTMLFromMarkdown(o.text):"",s=o.suggestedActions&&o.suggestedActions.actions?o.suggestedActions.actions:null,r=o.attachments?o.attachments:null;this.appendMessage("left",a,o.timestamp,s,r),o.channelData&&o.channelData.FileDialogPrompt&&this.createFileUploadArea()}if("message"===o.type&&o.from&&o.from.id===this.user.id){this.logger.log("activity.timestamp",o.timestamp),this.removeTyping(),this.hasReceivedAMessage=!1;var c=ZammoBotUIKit.get(o,"channelData.messageBack.displayText",o.displayText);a=ZammoBotUIKit.isset(c)?c:ZammoBotUIKit.isset(o.text)?o.text:"";a=HtmlSanitizer.SanitizeHtml(a);s=o.suggestedActions&&o.suggestedActions.actions?o.suggestedActions.actions:null,r=o.attachments?o.attachments:null;this.appendMessage("right",a,o.timestamp,s,r)}"event"===o.type&&"handoff.initiate"===o.name&&o.from&&o.from.id!==this.user.id&&this.appendEvent("You are in a queue for agent chat, one moment please."),"event"===o.type&&"zammo.agentjoined"===o.name&&o.from&&o.from.id!==this.user.id&&this.appendEvent(o.text),"event"===o.type&&"zammo.agentleft"===o.name&&o.from&&o.from.id!==this.user.id&&this.appendEvent(o.text),"typing"===o.type&&this.appendTyping(),o.type===ZammoBotUIKit.constants.customActivityType.ZammoRequestLocation&&this.handleLocationRequest()}}catch(e){this.logger.error("ZammoBotUIKit.ZammoBotUI.processWebsocketMessage","discarding",t,"because of",e)}},this.setConversationInformation=function(t,e){if(e=void 0!==e?e:null,this.conversation=t,t){var o=ZammoBotUIKit.storage();o.setConversationId(t.conversationId),o.setConversationToken(t.token),o.setHasStarted(!0)}ZammoBotUIKit.isWebSocketSupported(t.streamUrl,this.logger)?this.setConversationInformationWithSocket(e):this.setConversationInformationWithPolling()},this.setConversationInformationWithPolling=function(){var t=this;setTimeout((function(){ZammoBotUIKit.makeHTTPCall(t.directLineUrl+"/conversations/"+t.conversation.conversationId+"/activities?watermark="+t.conversation.watermark,(function(e){t.logger.log("ZammoBotUIKit.ZammoBotUI.checkConnection::","the existing conversation response is",e),t.conversation.watermark=e.watermark,t.processWebsocketMessage(JSON.stringify(e)),t.setConversationInformationWithPolling(t.conversation)}),"GET",null,{Authorization:"Bearer "+t.conversation.token,"Content-Type":"application/json"})}),1e3*ZammoBotUIKit.constants.ACTIVITIES_POLLING_INTERVAL)},this.setConversationInformationWithSocket=function(t){var e=this;this.socket=new WebSocket(e.conversation.streamUrl),this.socket.addEventListener("open",(function(o){e.logger.log("ZammoBotUIKit.ZammoBotUI.setConversationInformation::","the connection is opened",o),t&&t()})),this.socket.addEventListener("message",(function(t){e.logger.log("ZammoBotUIKit.ZammoBotUI.setConversationInformation::","message from the server ws",t),ZammoBotUIKit.IsStrAValidJson(t.data)?e.processWebsocketMessage(t.data):e.logger.log("ZammoBotUIKit.ZammoBotUI.setConversationInformation::","the message from the server was ignored since data is not an object",t)})),this.socket.addEventListener("close",(function(t){e.logger.log("ZammoBotUIKit.ZammoBotUI.setConversationInformation::","connection has been closed",t),e.socket=null})),this.socket.addEventListener("error",(function(t){e.logger.log("ZammoBotUIKit.ZammoBotUI.setConversationInformation::","connection had an error",t),e.socket=null}))},this.initializeDirectLineConversation=function(t,e,o){var n=this;ZammoBotUIKit.makeHTTPCall(n.directLineUrl+"/conversations",(function(t){n.logger.log("ZammoBotUIKit.ZammoBotUI.initializeDirectLineConversation::","the create conversation response is",t),n.setConversationInformation(t,e&&o?o:null),!e&&o&&o()}),"POST",JSON.stringify({locale:"en-US"}),{Authorization:"Bearer "+t,"Content-Type":"application/json"})},this.connectNew=function(t,e){var o=this;o.simulatorToken?(o.logger.log("connectNew will use the simulator token","zammoBotUIInstance.simulatorToken",o.simulatorToken),o.getSimulatorSessionInfo((function(n){n.isSuccess?(o.logger.log("connectNew:: directline token successfuly retrieved for simulator","getSimulatorSessionInfoResult",n),o.initializeDirectLineConversation(n.simulatorSessionInfo.directLineToken,e,(function(){e&&(o.logger.log("connectNew:: will send the launch activity for the simulator"),o.sendActivity({from:o.user,type:"event",text:"launch",entities:[{type:"SimulatorConfig",value:{token:o.simulatorToken,isChat:!0,isTryZammoWebchat:!0}}]})),t&&t()}))):(o.removeTyping(),o.showErrorMessage(n.error,-42))}))):(o.logger.log("connectNew will use the webachat ID","zammoBotUIInstance.webChatId",o.webChatId,"zammoBotUIInstance.user.id",o.user.id),ZammoBotUIKit.makeHTTPCall(o.zammoApiBaseUrl+"/api/webchat/token/"+o.webChatId+"/"+o.user.id,(function(n){o.tokenApiResponse=n,o.initializeDirectLineConversation(n.token,e,t)})))},this.connectExisting=function(t,e){var o=this;o.conversation&&o.conversation.id?ZammoBotUIKit.makeHTTPCall(o.directLineUrl+"/conversations/"+o.conversation.id+"?watermark=-",(function(n){n.token?(o.logger.log("ZammoBotUIKit.ZammoBotUI.connectExisting::","connected. the existing conversation response is",n),o.setConversationInformation(n,e&&t?t:null),!e&&t&&t()):(o.logger.log("ZammoBotUIKit.ZammoBotUI.connectExisting::","conversation expired, starting new conversation. the existing conversation response is",n),o.connectNew(t,e))}),"GET",null,{Authorization:"Bearer "+o.conversation.token,"Content-Type":"application/json"}):console.error("you're attempting to perform actions on a conversation that doesn't exist. You can verifiy previous error messages or contact your Zammo administrators.")},this.reconnect=function(t,e){var o=this;o.conversation&&o.conversation.conversationId?ZammoBotUIKit.makeHTTPCall(o.directLineUrl+"/conversations/"+o.conversation.conversationId,(function(n){n.token?(o.logger.log("ZammoBotUIKit.ZammoBotUI.reconnect::","connected. the existing conversation response is",n),o.setConversationInformation(n,e&&t?t:null),!e&&t&&t()):(o.logger.log("ZammoBotUIKit.ZammoBotUI.reconnect::","conversation expired, starting new conversation. the existing conversation response is",n),o.connectNew(t,e))}),"GET",null,{Authorization:"Bearer "+o.conversation.token,"Content-Type":"application/json"}):console.error("you're attempting to perform actions on a conversation that doesn't exist. You can verifiy previous error messages or contact your Zammo administrators.")},this.checkConnection=function(t,e){e=void 0!==e&&e;var o=ZammoBotUIKit.storage().getHasStarted();this.stickyChat&&!this.conversation.conversationId&&this.conversation.id&&this.conversation.token&&o?this.connectExisting(t,e):this.conversation&&this.conversation.conversationId?!this.socket&&this.conversation&&this.conversation.conversationId?this.reconnect(t,e):t&&t():this.connectNew(t,e)},this.sendActivity=function(t,e){for(var o=this,n=0;n<ZammoBotUIKit.Extensions.length;n++){var i=ZammoBotUIKit.Extensions[n];if(i.canHandleOutbound(t,o))return void i.handleOutbound(t,o,this.logger)}e=void 0!==e&&e,this.checkConnection((function(){o.logger.log("ZammoBotUIKit.ZammoBotUI.sendActivity::","will post the activity",t),o.conversation&&o.conversation.conversationId?ZammoBotUIKit.makeHTTPCall(o.directLineUrl+"/conversations/"+o.conversation.conversationId+"/activities",(function(t){o.logger.log("ZammoBotUIKit.ZammoBotUI.sendActivity::",t)}),"POST",JSON.stringify(t),{Authorization:"Bearer "+o.conversation.token,"Content-Type":"application/json"}):console.error("you're attempting to perform actions on a conversation that doesn't exist. You can verifiy previous error messages or contact your Zammo administrators.")}),e)},this.clearChatHistory=function(){if(this.chatArea)for(;this.chatArea.firstChild;)this.chatArea.removeChild(this.chatArea.firstChild)},this.resetSession=function(t,e){e||(e=!0);this.connectNew(t,e),this.appendTyping()},this.run=function(){var t=this;t.loadRequiredStylesAndScripts((function(){ZammoBotUIKit.addViewportIfNotAvailable(),document.body.appendChild(t.getBotUIComponent()),t.setProperties(),t.setCommands(),t.isFirstOpening=!0,t.stickyChat&&ZammoBotUIKit.storage().getStayOpen()&&t.openChat()}))}},ZammoBotUIKit.initialize=function(t){var e=document.getElementById("ZammoBotUIKitScript"),o=ZammoBotUIKit.getAttributeOrDefault(e,"cssUrl","zammo-bot-ui-kit.css"),n=ZammoBotUIKit.getAttributeOrDefault(e,"zammoApiBaseUrl","https://localhost:5001"),i=ZammoBotUIKit.getAttributeOrDefault(e,"stickyChat","false"),a=ZammoBotUIKit.getAttributeOrDefault(e,"ttl","3600000"),s=ZammoBotUIKit.getAttributeOrDefault(e,"environment","production"),r=t||e.getAttribute("webchatId"),c=e.hasAttribute("unbranded"),m=ZammoBotUIKit.getAttributeOrDefault(e,"directLineUrl","https://directline.botframework.com/v3/directline"),l=ZammoBotUIKit.getAttributeOrDefault(e,"shouldLoadDependencies","true"),d=ZammoBotUIKit.getAttributeOrDefault(e,"shouldShowMicrophone","false"),u=ZammoBotUIKit.getAttributeOrDefault(e,"shouldShowExtensionMenu","false"),h=ZammoBotUIKit.getAttributeOrDefault(e,"simulatorToken",null);return new ZammoBotUIKit.ZammoBotUI({environment:s,cssUrl:o,zammoApiBaseUrl:n,webChatId:r,stickyChat:i,shouldHideBranding:c,ttlInMilliseconds:a,directLineUrl:m,shouldLoadDependencies:l,shouldShowMicrophone:"true"===d,shouldShowExtensionMenu:"true"===u,simulatorToken:h})},ZammoBotUIKit.onDocumentReady((function(){var t=document.getElementById("ZammoBotUIKitScript");if(!t.getAttribute("randomUID")){for(var e=document.querySelectorAll("#ZammoBotUIKitScript"),o=0;o<e.length;o++)e[o].setAttribute("randomUID",ZammoBotUIKit.uuidv4());if(t){var n=ZammoBotUIKit.initialize();"standalone"===ZammoBotUIKit.getAttributeOrDefault(t,"executionType","standalone")&&n.run()}else console.error("The Zammo Bot UI Kit is not properly configured, please go to <instruction link>")}})),window.ZammoBotUIKit=ZammoBotUIKit;
